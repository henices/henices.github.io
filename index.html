<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"usmacd.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="å®‰å…¨ä»£ç ">
<meta property="og:url" content="http://usmacd.com/index.html">
<meta property="og:site_name" content="å®‰å…¨ä»£ç ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="henices">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://usmacd.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>å®‰å…¨ä»£ç </title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="å®‰å…¨ä»£ç " type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">å®‰å…¨ä»£ç </h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="henices"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">henices</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">84</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/henices" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;henices" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/henices" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;henices" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://scz.617.cn:8/" title="http:&#x2F;&#x2F;scz.617.cn:8&#x2F;" rel="noopener" target="_blank">é£èŠ±å ‚</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.v2ex.com/" title="https:&#x2F;&#x2F;www.v2ex.com&#x2F;" rel="noopener" target="_blank">V2EX</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.forecho.com/" title="https:&#x2F;&#x2F;blog.forecho.com&#x2F;" rel="noopener" target="_blank">forecho</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://chensenlin.cn/" title="https:&#x2F;&#x2F;chensenlin.cn&#x2F;" rel="noopener" target="_blank">ä½ å¥½æˆ‘æ˜¯æ£®æ—</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/10/08/logseq3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/08/logseq3/" class="post-title-link" itemprop="url">Logseq ä½¿ç”¨å°ç»“ ï¼ˆä¸‰ï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-08 00:00:00" itemprop="dateCreated datePublished" datetime="2022-10-08T00:00:00+08:00">2022-10-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ä½¿ç”¨ Logseq å†™ç¬”è®°å·²ç»å¤§åŠå¹´äº†ï¼ŒLogseq æ˜¯è¿™ä¹ˆå¤šå¹´æ¥é™¤äº† vim ä¹‹å¤–ï¼Œå”¯ä¸€å¯ä»¥åœ¨ä½¿ç”¨ä¸Šèºæ—‹ä¸Šå‡çš„è½¯ä»¶ã€‚æˆ‘æŠŠ Logseq æ¨èç»™åª³å¦‡ï¼Œå¥¹ç”¨æ¥å†™ä¼šè®®çºªè¦ï¼Œå†™å¤‡å¿˜å½•ï¼Œç®¡ç†å¾…åŠäº‹é¡¹ï¼Œä¹Ÿç”¨å¾—æŒºå¥½ã€‚</p>
<p>Logseq çš„æˆåŠŸä¹‹å¤„åœ¨äºå®ƒé™ä½äº†è®°å½•çš„æˆæœ¬ï¼Œä¸éœ€è¦å¤§æ®µå¤§æ®µçš„æ–‡å­—ï¼Œä¹Ÿä¸éœ€è¦å¤ªå¤šçš„æ–‡ç« ç»“æ„ï¼Œéšæ—¶éƒ½å¯ä»¥è®°å½•ã€‚Logseq æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜æ˜¯ï¼Œå®ƒçš„ä½¿ç”¨å¤ªçµæ´»äº†ï¼Œæ—¶é—´ä¸€æ‹‰é•¿ï¼Œå‰åè®°å½•çš„æ ‡å‡†ã€æ ¼å¼ã€æ ‡ç­¾ç­‰è¦ç´ å¯èƒ½ä¸ä¸€è‡´ï¼Œå®¹æ˜“é€ æˆç¬”è®°å‡Œä¹±ã€‚ç¬”è®°ä¸€å‡Œä¹±å°±æ²¡æ³•æœ‰æ•ˆçš„èšåˆï¼Œç¬”è®°çš„æœ‰æ•ˆèšåˆå½¢æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„æƒ³æ³•ç¾¤æ˜¯ Logseq ç­‰åŒé“¾è½¯ä»¶å’Œå…¶ä»–ç¬”è®°è½¯ä»¶ç›¸æ¯”æœ€æœ‰ä»·å€¼çš„åœ°æ–¹ã€‚</p>
<p>æˆ‘è¿™åŠå¹´æ¥æ€»ç»“å‡ºç¬”è®°ç³»ç»ŸæˆåŠŸçš„å…³é”®æ˜¯ï¼š åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œç”¨åŒæ ·çš„æ ¼å¼å’Œä¸€è‡´çš„æ ‡å‡†è®°å½•ä½ çš„æ´è§ã€‚ä½†æ˜¯ç”±äº Logseq ç¼ºä¹æœ‰æ•ˆçš„å·¥ä½œæµï¼Œæ²¡æ³•è‡ªåŠ¨åŒ–æç¤ºå¿…è¦çš„æ­¥éª¤ï¼Œåªèƒ½é€šè¿‡ä¸æ–­çš„ç»ƒä¹ æ¥å¼ºåŒ–å­¦ä¹ ã€‚å¦å¤– Logseq ä¸­ page å’Œ tag åªæ˜¯èµ·åˆ°è¿‡æ»¤ç¬”è®°çš„ä½œç”¨ï¼Œæœ€å…³é”®çš„ç¬”è®°ä¹‹é—´çš„é“¾æ¥å´å¾ˆå®¹æ˜“è¢«å¿½è§†ï¼Œtag çš„æ•°é‡ä¸€å¤šåˆä¼šå¼€å§‹ç¬”è®°å‡Œä¹±äº†ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œå¦‚æœåªæ˜¯æŠŠ Logseq ä½œä¸ºå¤‡å¿˜ï¼Œæˆ–è€…ç®€å•ä½œä¸ºä¿¡æ¯è®°å½•ï¼ŒæŒºå¥½ç”¨ä¹Ÿä¸éœ€è¦å­¦ä¹ å¤ªå¤šçš„ä¸œè¥¿ï¼Œä½†æ˜¯å¦‚æœéœ€è¦ä½¿ç”¨ Logseq æ¥å®è·µå¡ç‰‡ç¬”è®°æ³•ç­‰ PKM ç†è®ºï¼Œææ€•è¿˜æ˜¯éœ€è¦èŠ±è´¹ä¸€äº›åŠŸå¤«ä»”ç»†ç¢ç£¨ä¸€ç•ªã€‚PKM æ–¹é¢çš„ä¹¦ç±æˆ‘å¼ºåŠ›æ¨è ã€Šå¡ç‰‡ç¬”è®°å†™ä½œæ³•ã€‹ä¸€ä¹¦ï¼Œä¸­æ–‡ç¿»è¯‘å¾ˆä¸é”™ï¼Œè™½ç„¶ä¹¦åæ˜¯è°ˆå†™ä½œï¼Œé‡Œé¢çš„å†…å®¹å´æ¶‰åŠå¾ˆå¹¿ï¼Œæˆ‘è‡ªå·±é˜…è¯»åæ”¶ç›Šè‰¯å¤šã€‚</p>
<p>ä¸Šé¢è¯´çš„æ˜¯ä¸€äº›ã€Œé“ã€å±‚é¢çš„ä¸œè¥¿ï¼Œ Logseq åœ¨ã€Œæœ¯ã€æ–¹é¢çš„ä¸œè¥¿ä¹Ÿä¸å°‘ï¼Œä¸‹é¢å°†ä»‹ç»ä¸€äº›å‰ä¸¤ç¯‡å°šæœªæ¶‰åŠçš„åŠŸèƒ½å’Œä½¿ç”¨æŠ€å·§ã€‚</p>
<h2 id="â˜†-ä½¿ç”¨-properties"><a href="#â˜†-ä½¿ç”¨-properties" class="headerlink" title="â˜† ä½¿ç”¨ properties"></a>â˜† ä½¿ç”¨ properties</h2><p><a target="_blank" rel="noopener" href="https://docs.logseq.com/#/page/term%2Fproperties">https://docs.logseq.com/#/page/term%2Fproperties</a></p>
<p>åœ¨ Logseq ä¸­æœ‰ä¸¤ç§ propertiesï¼Œ page properties å’Œ block propertiesã€‚</p>
<ul>
<li>Page properties åœ¨ç¬¬ä¸€ä¸ª block å†™ <code>property:: value</code>  </li>
<li>Block properties åœ¨æ¯ä¸ª block å†…ä½¿ç”¨ <code>property:: value</code></li>
</ul>
<p>åœ¨ä½¿ç”¨ block properties æ—¶ï¼Œéœ€è¦è¾“å…¥ <code>shift + Enter</code> æ¥è¿›è¡Œæ¢è¡Œï¼Œæ¢è¡Œåè¾“å…¥ <code>::</code> Logseq ä¼šè‡ªåŠ¨æç¤ºå·²ç»ä½¿ç”¨è¿‡çš„ propertyã€‚ç†è§£ properties å¯ä»¥ç®€å•çš„æŠŠ block çœ‹æˆæ•°æ®åº“çš„ä¸€æ¡è®°å½•ï¼Œ properties å°±æ˜¯ä¸åŒçš„å­—æ®µï¼Œå¯ä»¥é€šè¿‡ Logseq çš„ query æ¥æŸ¥è¯¢ç›¸å…³è®°å½•ã€‚åœ¨ä½¿ç”¨ properties æ—¶å¯ä»¥å¼•ç”¨ page æˆ–è€… tagï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•æ¥ç´¢å¼•è¿™æ¡è®°å½•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘å°†ä¹¦ç±çš„ block éƒ½æ·»åŠ äº† <code>category:: Books</code> çš„å±æ€§ï¼Œåç»­å¯ä»¥ä½¿ç”¨ <code>&#123;&#123;query (property category Books) &#125;&#125;</code> æ¥æŸ¥è¯¢æ‰€æœ‰ä¹¦ç±äº†ï¼Œæ„Ÿè§‰ä¸Šæœ‰ç‚¹ç±»ä¼¼ notion çš„è¡¨æ ¼ã€‚</p>
<p><img src="https://github.com/henices/pictures/raw/master/logseq3_1.png"></p>
<h2 id="â˜†-ä½¿ç”¨-x2F-Scheduled-åˆ¶å®šè®¡åˆ’"><a href="#â˜†-ä½¿ç”¨-x2F-Scheduled-åˆ¶å®šè®¡åˆ’" class="headerlink" title="â˜† ä½¿ç”¨ &#x2F;Scheduled åˆ¶å®šè®¡åˆ’"></a>â˜† ä½¿ç”¨ &#x2F;Scheduled åˆ¶å®šè®¡åˆ’</h2><p>ä½¿ç”¨ Schedule çš„åŠŸèƒ½çš„æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œåœ¨å†™å®Œä¸€æ¡ block åï¼Œè¾“å…¥ <code>shift + enter </code> æ¢è¡Œåï¼Œè¾“å…¥ <code>/Schedule</code> åœ¨å¼¹å‡ºçš„ç•Œé¢ä¸­é€‰æ‹©æ—¶é—´å‘¨æœŸå³å¯ã€‚</p>
<p><img src="https://github.com/henices/pictures/raw/master/logseq3_2.png"></p>
<p>åœ¨ Schedule è§„å®šçš„æ—¶é—´å†…ï¼ŒLogseq çš„ Journals é¡µé¢å¯ä»¥çœ‹åˆ°ç›¸å…³çš„å†…å®¹ã€‚</p>
<h2 id="â˜†-ä¸€äº›å¥½ç”¨çš„æ’ä»¶"><a href="#â˜†-ä¸€äº›å¥½ç”¨çš„æ’ä»¶" class="headerlink" title="â˜† ä¸€äº›å¥½ç”¨çš„æ’ä»¶"></a>â˜† ä¸€äº›å¥½ç”¨çš„æ’ä»¶</h2><p>æ’ä»¶å¯ä»¥æ‹“å±• Logseq çš„åŠŸèƒ½ï¼Œä½¿ç”¨äº†æ’ä»¶çš„æ–¹æ³•åœ¨ <a target="_blank" rel="noopener" href="https://www.usmacd.com/2022/03/07/logseq2/">Logseq ä½¿ç”¨å°ç»“ ï¼ˆäºŒï¼‰</a> ä¸­æœ‰è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´ã€‚</p>
<h3 id="Logseq-Plugin-Tabs"><a href="#Logseq-Plugin-Tabs" class="headerlink" title="Logseq Plugin Tabs"></a>Logseq Plugin Tabs</h3><p><a target="_blank" rel="noopener" href="https://github.com/pengx17/logseq-plugin-tabs">https://github.com/pengx17/logseq-plugin-tabs</a></p>
<p>Plugin Tabs åƒæ‰“å¼€æµè§ˆå™¨ä¸€æ ·æ‰“å¼€ pages æˆ–è€… blocksï¼Œå¯¹äºå†…å®¹æ¯”è¾ƒå¤šçš„ pageï¼Œè¿™ä¸ªæ’ä»¶éå¸¸å®ç”¨ã€‚</p>
<p><img src="https://github.com/henices/pictures/raw/master/logseq3_4.png"></p>
<h3 id="logseq-plugin-mark-map"><a href="#logseq-plugin-mark-map" class="headerlink" title="logseq-plugin-mark-map"></a>logseq-plugin-mark-map</h3><p><a target="_blank" rel="noopener" href="https://github.com/vipzhicheng/logseq-plugin-mark-map">https://github.com/vipzhicheng/logseq-plugin-mark-map</a></p>
<p>Mark map å¯ä»¥è‡ªåŠ¨åŒ–åœ°æŠŠä½ çš„ç¬”è®°ç”¨å¯¼å›¾çš„å½¢å¼è¾“å‡ºï¼Œæ–¹é¢å±•ç¤ºå’Œè®°å¿†ã€‚</p>
<p><img src="https://github.com/henices/pictures/raw/master/logseq3_5.png"></p>
<h2 id="â˜†-ä¸€äº›ä½¿ç”¨ä¸Šçš„å°æŠ€å·§"><a href="#â˜†-ä¸€äº›ä½¿ç”¨ä¸Šçš„å°æŠ€å·§" class="headerlink" title="â˜† ä¸€äº›ä½¿ç”¨ä¸Šçš„å°æŠ€å·§"></a>â˜† ä¸€äº›ä½¿ç”¨ä¸Šçš„å°æŠ€å·§</h2><ul>
<li>Logseq content wide mode  å¯ä»¥ä½¿ç”¨å¿«æ·é”®åˆ‡æ¢ <code>t w</code>  </li>
<li>Logseq çš„ property å¯ä»¥é€šè¿‡è¾“å…¥ <code>::</code> æ¥è§¦å‘è‡ªåŠ¨è¡¥å…¨æ“ä½œï¼Œéå¸¸æ–¹ä¾¿ã€‚  </li>
<li>Logseq ä½¿ç”¨å¿«æ·é”® <code>Cmd + Shift + i</code> å¯ä»¥æ‰“å¼€ devtools  </li>
<li>Logseq v0.68ï¼Œè‡ªåŠ¨è¡¥å…¨æä¾›ä¸¤ä¸ªå¿«æ·é”® <code>mod+p</code> å’Œ <code>mod+n</code> æ¯”è¾ƒæ–¹ä¾¿äº†  </li>
<li>Logseq å¯ä»¥ä½¿ç”¨ <code>command + </code> å’Œ <code>command -</code> æ¥æ”¾å¤§æˆ–è€…ç¼©å° Logseq çš„å­—ä½“å¤§å°  </li>
<li>Logseq 0.7.1 æ–°åŠŸèƒ½ï¼šCopy &amp; Paste with rich-text formatsï¼Œå¦‚æœç²˜è´´æ—¶ä¸æƒ³ä¿ç•™æ ¼å¼ <code>mod + shift + v</code>  </li>
<li>Logseq ç§»åŠ¨å…‰æ ‡çš„å¿«æ·é”®ï¼š<code>mod + p</code> å‘ä¸Šç§»åŠ¨å…‰æ ‡ï¼Œ<code>mod + n</code> å‘ä¸‹ç§»åŠ¨å…‰æ ‡  </li>
<li>Logseq Markdown è¯­æ³•æ”¯æŒ <code> Horizontal Rules</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>---</code>åˆ†éš”å¡ç‰‡ç¬”è®°ã€‚</li>
</ul>
<p>mod åœ¨ windows å’Œ linux ç³»ç»Ÿä¸­æ˜¯ <code>ctrl</code>ï¼Œ åœ¨ macOS ç³»ç»Ÿä¸­æ˜¯ <code>command</code></p>
<h2 id="â˜†-å‚è€ƒé“¾æ¥"><a href="#â˜†-å‚è€ƒé“¾æ¥" class="headerlink" title="â˜†  å‚è€ƒé“¾æ¥"></a>â˜†  å‚è€ƒé“¾æ¥</h2><p><a target="_blank" rel="noopener" href="https://www.usmacd.com/2022/02/21/logseq/">https://www.usmacd.com/2022/02/21/logseq/</a><br><a target="_blank" rel="noopener" href="https://www.usmacd.com/2022/03/07/logseq2/">https://www.usmacd.com/2022/03/07/logseq2/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/09/16/note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/16/note/" class="post-title-link" itemprop="url">å…³äºç¬”è®°çš„ä¸€äº›æ€è€ƒ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-16 00:00:00" itemprop="dateCreated datePublished" datetime="2022-09-16T00:00:00+08:00">2022-09-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-23 00:00:00" itemprop="dateModified" datetime="2022-09-23T00:00:00+08:00">2022-09-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><p>Random Notes (æ¼«æ¸¸ç¬”è®°) çš„æŠ€æœ¯åŸç†æ˜¯ç”¨æ–°è§†è§’å»å®¡è§†æ—§æƒ³æ³•ï¼Œå’Œè‡ªå·±ä»¥å‰çš„æƒ³æ³•ä¸æœŸè€Œé‡çš„æ„Ÿè§‰éå¸¸å¥‡å¦™ã€‚æ€»ä½“æ¥è¯´äººæ˜¯ä¼šä¸æ–­è¿›æ­¥çš„ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´åå†å»é‡æ¸©è‡ªå·±æŸä¸ªæ—¶åˆ»çš„æƒ³æ³•ï¼Œå¯èƒ½ä»¥å‰çš„ä¸€äº›ç–‘æƒ‘ç°åœ¨å·²ç»æ²¡æœ‰äº†ï¼Œä¹Ÿå¯èƒ½å¯¹æŸä¸ªé—®é¢˜æœ‰äº†æ›´è¿›ä¸€æ­¥çš„æ€è·¯ï¼Œè¿™æ˜¯ä¿ƒä½¿æƒ³æ³•è¿­ä»£çš„ä¸€ç§æ–¹æ³•ã€‚</p>
</li>
<li><p>æƒ³è¦åšåˆ°æƒ³æ³•çš„è‡ªç„¶è¿­ä»£ï¼Œå¿…è¦çš„æ¡ä»¶æ˜¯å¯ä»¥é©¬ä¸Šå›åˆ°è¿‡å»çš„æŸä¸ªæ—¶åˆ»ï¼Œè€Œä¸”é‚£ä¸ªæ—¶åˆ»çš„ä¸Šä¸‹æ–‡æ²¡æœ‰ä¸¢å¤±ï¼Œå¦‚æœä¸Šä¸‹æ–‡ä¸¢å¤±æ„å‘³ç€å·²ç»çœ‹ä¸æ‡‚ä»¥å‰çš„ç¬”è®°äº†ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰äº†è¿­ä»£çš„å¯èƒ½æ€§ã€‚</p>
</li>
<li><p>å¡ç‰‡ç›’ç¬”è®°æ³•è¦æ±‚ç”¨å®Œæ•´çš„å¥å­ç²¾è¦ç®€è¿°æƒ³æ³•ï¼Œç¬”è®°ä¹‹é—´çš„è¿æ¥åˆ™è¡¥å……äº†ä¸Šä¸‹æ–‡ï¼Œä¸ºæƒ³æ³•è¿­ä»£åˆ›é€ äº†æœ‰åˆ©æ¡ä»¶ã€‚</p>
</li>
<li><p>å†™æ°¸ä¹…ç¬”è®°æ—¶ï¼Œåº”è¯¥å‡è®¾è¯»è€…å¯¹æ–‡æœ¬èƒŒåçš„æ€æƒ³ï¼ŒåŸæ–‡èƒŒæ™¯ä¸€æ— æ‰€çŸ¥ï¼Œåªå…·å¤‡ç›¸å…³çš„é¢†åŸŸçŸ¥è¯†ã€‚è¿™é‡Œçš„è¯»è€…å…¶å®ä¹ŸåŒ…æ‹¬æœªæ¥çš„è‡ªå·±ï¼Œæˆ‘ä»¬å†™ä¸‹æ°¸ä¹…ç¬”è®°åï¼Œå¾ˆå¿«å°±ä¼šå°†å…¶çš„ä¸Šä¸‹æ–‡é—å¿˜ï¼Œå°±æƒ³ä»æ²¡æœ‰è§è¿‡è¯¥ç¬”è®°çš„å…¶ä»–è¯»è€…ä¸€æ ·ã€‚</p>
</li>
<li><p>æˆ‘ä»¬åº”è¯¥å¯»æ‰¾ä¸æˆ‘ä»¬è§‚ç‚¹ç›¸åçš„è®ºç‚¹æˆ–è€…äº‹å®æ¥æŒ‘æˆ˜æˆ‘ä»¬çš„æ—¢æœ‰æ€ç»´ï¼Œä½†æ˜¯å—ã€Œç¡®è®¤åå·®ã€çš„å½±å“ï¼Œæˆ‘ä»¬ä¼šä¸ç»æ„çš„å¿½ç•¥è¿™äº›ä¿¡æ¯ï¼Œé‚£äº›å’Œæˆ‘ä»¬è§‚ç‚¹ä¸€è‡´çš„ä¿¡æ¯æœ‰å¾ˆå¤§å¸å¼•åŠ›ï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯å¯ä»¥è¯æ˜è‡ªå·±å¾ˆåšå­¦ã€‚è§£å†³ ã€Œç¡®è®¤åå·®ã€çš„æ–¹æ³•ï¼šæŠŠå¯»æ‰¾è¯å®æ€§ä¿¡æ¯å˜ä¸ºæ”¶é›†æ‰€æœ‰ä¿¡æ¯ï¼Œä¸éœ€è¦å…³æ³¨è¿™äº›ä¿¡æ¯æ”¯æŒçš„å…·ä½“è§‚ç‚¹ã€‚</p>
</li>
<li><p>æˆ‘ä»¬ä½¿ç”¨å¡ç‰‡ç›’ç¬”è®°æ³•ï¼Œå¯¹ä¹ æƒ¯æœ€é‡è¦çš„è½¬å˜æ˜¯å°†æ³¨æ„åŠ›ä»ä¸ªåˆ«é¡¹ç›®çš„é¢„è®¾ç«‹åœºå˜æˆæ€è€ƒç¬”è®°ä¹‹é—´çš„å¼€æ”¾æ€§è”ç³»ã€‚é€šè¿‡ä¸€æ®µæ—¶é—´çš„è®­ç»ƒï¼Œåœ¨é˜…è¯»è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥è½»æ¾æ‰¾å‡ºä¸é¢„è®¾è§‚ç‚¹ç›¸æ‚–çš„ä¿¡æ¯ã€‚å½“è¿™äº›ä¿¡æ¯æ”¹å˜æˆ‘ä»¬å¯¹æŸäº›é—®é¢˜çš„çœ‹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼šæ„Ÿåˆ°ç›¸å½“å…´å¥‹ï¼Œä»è€Œæ…¢æ…¢å–œæ¬¢ä¸Šè¿™ç§æ„Ÿè§‰ã€‚</p>
</li>
<li><p>åœ¨å®è·µå¡ç‰‡ç¬”è®°æ³•çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé‡ä¸Šä¸€æ•´å¤©éƒ½æ²¡å†™ä¸€å¼ å¡ç‰‡çš„æ—¶å€™ï¼Œè€Œæœ‰çš„æ—¶å€™åˆ™ä¸€å¤©å†™åå¤šå¼ å¡ç‰‡ã€‚é™åˆ¶æ¯å¤©å†™ç¬”è®°çš„æ•°é‡å¯ä»¥è®©å†™å¡ç‰‡ç›’ç¬”è®°çš„è¿‡ç¨‹æ›´åŠ è½»æ¾ï¼Œé¿å…äº†è¿‡äºæ”¾æ¾çš„çŠ¶æ€ï¼Œä¹Ÿé¿å…äº†è¿‡äºç´§ç»·çš„çŠ¶æ€ï¼Œæœ‰åˆ©äºæˆ‘ä»¬ä¿æŒè‰¯å¥½çš„çŠ¶æ€ã€‚å¦ä¸€ä¸ªå¥½å¤„åˆ™æ˜¯è®©ä½ é€‰æ‹©ç¬”è®°å†…å®¹æ—¶æ›´åŠ æŒ‘å‰”ï¼Œæœ‰åˆ©äºæé«˜ç¬”è®°çš„è´¨é‡ã€‚</p>
</li>
<li><p>ä½ å¯ä»¥å°†ç›®æ ‡è®¾ç½®ä¸ºæ¯å¤©å†™3æ¡ç¬”è®°ï¼Œæˆ–è€…æ¯å¹´å‡ºä¸€æœ¬ä¹¦ï¼Œä»ç„¶å¯ä»¥åœ¨åˆç†çš„æ—¶é—´å†…ç§¯ç´¯å¤§é‡çš„æƒ³æ³•ã€‚</p>
</li>
<li><p>å…³äºç¬”è®°ç®¡ç†å­˜åœ¨å‡ ä¸ªè¯¯åŒºï¼Œ1. ç¬”è®°è½¯ä»¶&#x2F;åšå®¢ç³»ç»Ÿï¼Œæˆ‘å…ˆåä½¿ç”¨è¿‡ EverNoteï¼ŒWizNoteï¼ŒVNoteï¼ŒCSDN blogï¼ŒGoogle blogspot, WordPress 2. ç¬”è®°æ ¼å¼ï¼Œæˆ‘å…ˆåä½¿ç”¨è¿‡ txt, orgmode, markdown å…¶å®è¿™äº›éƒ½ä¸æ˜¯å…³é”®ï¼Œé™¤äº†æŠ˜è…¾è¿˜æ˜¯æŠ˜è…¾ã€‚ä»¥å‰æˆ‘å¸¸è¯´ä¸€ä¸ªæ®µå­ï¼Œä½ ä»¥ä¸ºä½ åœ¨å†™åšå®¢ï¼Œå…¶å®ä½ åœ¨æŠ˜è…¾ Wordpress æ’ä»¶ã€‚</p>
</li>
<li><p>æˆ‘ä»¥å‰æ€è€ƒè¿™ä¸ªé—®é¢˜è®¤ä¸ºæ˜¯ç¬”è®°ç¼ºä¹ç»„ç»‡ç»“æ„ï¼Œå®è·µç»“æœè¡¨æ˜è‰¯å¥½çš„åˆ†ç±»ç¡®å®æœ‰ä¸€å®šå¸®åŠ©ï¼Œä½†æ˜¯ä¸æ˜¯æœ€é‡è¦çš„ã€‚æœ€é‡è¦çš„æ˜¯åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œç”¨åŒæ ·çš„æ ¼å¼å’Œä¸€è‡´çš„æ ‡å‡†è®°å½•ä½ çš„æ´è§ã€‚</p>
</li>
<li><p>å„ç§ç¬”è®°è½¯ä»¶ï¼Œåšå®¢ç³»ç»Ÿï¼Œç¬”è®°æ ¼å¼çš„åˆ‡æ¢éƒ½ä¼šå¸¦æ¥ä¿¡æ¯ä¸¢å¤±ã€‚ä¿¡æ¯ä¸¢å¤±å®¹æ˜“é€ æˆå¿ƒç†è´Ÿæ‹…ï¼Œæˆ‘ä» 2005 å¹´å¼€å§‹å†™æ–‡ç« åˆ°ç°åœ¨å·²ç»ä¸¢å¤±äº† 50%ä»¥ä¸Šï¼Œè¿™äº›æ–‡ç« æ•£è½åœ¨äº’è”ç½‘çš„å„ä¸ªè§’è½ï¼Œéå¸¸ä»¤äººç—›å¿ƒã€‚</p>
</li>
<li><p>å¡ç‰‡ç¬”è®°æ³•å±äºè‡ªä¸‹è€Œä¸Šçš„å‘æ•£æ€ç»´ï¼Œå‘æ•£æ€ç»´æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ— æ³•æŠŠæ¡å‘æ•£çš„åº¦ã€‚ä¸ºäº†åº”å¯¹è¿™ä¸ªé—®é¢˜ï¼Œå¢æ›¼æå‡ºçš„åŠæ³•æ˜¯ä»”ç»†æ€è€ƒç¬”è®°ä¹‹é—´çš„è”ç³»ï¼Œå†™ç¬”è®°æ—¶å‚è€ƒæ–‡çŒ®ç¬”è®°å’Œè‡ªå·±ä»¥å‰å†™çš„ç¬”è®°ï¼Œå®šæœŸè‡ªä¸Šè€Œä¸‹åˆ¶ä½œç´¢å¼•å¡ç‰‡ï¼Œè¿™äº›åšæ³•çš„ç›®çš„æ˜¯é¿å…æƒ³æ³•è¿‡äºå¤ªå‘æ•£ã€‚</p>
</li>
<li><p>æ€ç»´éœ€è¦å‘æ•£ï¼Œä½†æ˜¯é¢†åŸŸéœ€è¦èšç„¦ï¼Œæˆ‘ä»¬åœ¨è‡ªå·±çš„ä¸“ä¸šï¼Œè´¢åŠ¡ç­‰é¢†åŸŸæ˜¯éœ€è¦ä¸æ–­ç²¾è¿›çš„ï¼Œè¿™ä¸¤ä¸ªæ–¹é¢ä¼¼ä¹æ˜¯çŸ›ç›¾çš„ã€‚æœ‰äººå»ºè®®ä½¿ç”¨åˆ†ç±»æ³•ï¼ŒæŠŠå…³æ³¨çš„é¢†åŸŸåˆ†ç±»ï¼Œåœ¨æ—¥å¸¸å·¥ä½œå­¦ä¹ ä¸­ä¸æ–­å®Œå–„ï¼Œä½†è¿™ç§æ–¹æ³•å¾ˆå®¹æ˜“å›åˆ°èµ„æ–™å½’æ¡£çš„è€è·¯ã€‚</p>
</li>
<li><p>æœ€è¿‘çš„ç ”ç©¶å‘ç°å¯ä»¥ä½¿ç”¨ P.A.R.A. æ¥ç»„ç»‡é¡¶å±‚ç»“æ„ï¼Œç»Ÿé¢†éœ€è¦ç²¾è¿›çš„é¢†åŸŸï¼Œåœ¨å…·ä½“æƒ³æ³•çš„è®°å½•ä¸Šåˆ™ç»§ç»­ä½¿ç”¨å¡ç‰‡ç¬”è®°æ³•ã€‚è¿™ç§æ–¹æ³•ä½¿ç”¨ P.A.R.A. ä¸æ–­æ¨åŠ¨è‡ªå·±åœ¨å…³æ³¨é¢†åŸŸçš„å–å¾—è¿›å±•ï¼Œåˆèƒ½åœ¨å…³é”®çš„æ€è€ƒä¸Šä½¿ç”¨å¡ç‰‡ç¬”è®°æ³•ï¼Œè‡ªç”¨ä¸€æ®µæ—¶é—´æ„Ÿè§‰ä¸é”™ã€‚</p>
</li>
</ul>
<p>æœªå®Œï¼Œå¾…ç»­ â€¦</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/09/08/trader_vic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/08/trader_vic/" class="post-title-link" itemprop="url">ä¸“ä¸šæŠ•æœºåŸç†ä¸­çš„æŠ€æœ¯åˆ†ææ³•åˆ™æ‘˜è¦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-08 00:00:00" itemprop="dateCreated datePublished" datetime="2022-09-08T00:00:00+08:00">2022-09-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æœ‰å…³é‡‘èå¸‚åœºæ–¹é¢çš„ä¹¦æˆ‘ä¸ªäººçš„å›¾ä¹¦é¦†é‡Œè‡³å°‘æœ‰1200æœ¬ã€‚å®ƒä»¬ä¸»è¦æ˜¯è®¨è®ºè¯åˆ¸åˆ†æã€æœŸæƒç­–ç•¥ã€æœŸè´§ç­–ç•¥ã€æŠ€æœ¯åˆ†æä»¥åŠå…¶ä»–ç›¸å…³æ–¹é¢çš„ä¹¦ã€‚è¿™äº›ä¹¦å¤§å¤šéƒ½åŒ…å«ç›¸å½“ä¸é”™çš„æ„æƒ³ï¼Œå…¶ä¸­çº¦2%æ˜¯çœŸæ­£ä¼˜ç§€çš„ä½œå“ã€‚ç„¶è€Œï¼Œå®ƒä»¬å¤§å¤šå­˜åœ¨ä¸€ä¸ªå…±åŒçš„é—®é¢˜ï¼šè¯•å›¾æ¨é”€ä¸€ç§â€œæˆ˜èƒœå¸‚åœºâ€çš„æ–¹æ³•ï¼Œå¾ˆå¤šæ–¹æ³•ç”šè‡³æ²¡æœ‰ç»è¿‡å®é™…å¸‚åœºçš„å®Œæ•´æµ‹è¯•ã€‚</p>
<h2 id="å¦‚ä½•æ­£ç¡®çš„ç»˜åˆ¶è¶‹åŠ¿çº¿"><a href="#å¦‚ä½•æ­£ç¡®çš„ç»˜åˆ¶è¶‹åŠ¿çº¿" class="headerlink" title="å¦‚ä½•æ­£ç¡®çš„ç»˜åˆ¶è¶‹åŠ¿çº¿"></a>å¦‚ä½•æ­£ç¡®çš„ç»˜åˆ¶è¶‹åŠ¿çº¿</h2><p>ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ç»˜åˆ¶è¶‹åŠ¿çº¿å¯ä»¥æä¾›ä¸€è‡´è€Œç²¾ç¡®çš„ç»“æœï¼Œè€Œä¸”ç»å¯¹ä¸ä¼šäº§ç”Ÿé”™è¯¯çš„ä¿¡å·ï¼š</p>
<ol>
<li>é€‰æ‹©è€ƒè™‘çš„æ—¶é—´ï¼šé•¿æœŸï¼ˆæ•°æœˆè‡³æ•°å¹´ï¼‰ã€ä¸­æœŸï¼ˆæ•°ä¸ªæ˜ŸæœŸè‡³æ•°æœˆï¼‰æˆ–çŸ­æœŸï¼ˆæ•°å¤©è‡³æ•°ä¸ªæ˜ŸæœŸï¼‰ã€‚</li>
<li>ä¸Šå‡è¶‹åŠ¿çº¿ï¼šåœ¨è€ƒè™‘çš„æ—¶é—´å†…ï¼Œä»¥æœ€ä½çš„ä½ç‚¹ä¸ºèµ·ç‚¹ï¼Œå‘å³ä¸Šæ–¹ç»˜åˆ¶ä¸€æ¡ç›´çº¿ï¼Œè¿æ¥æœ€é«˜ç‚¹å‰çš„æŸä¸€ä¸ªä½ç‚¹ï¼Œä½¿è¿™æ¡ç›´çº¿åœ¨ä¸¤ä¸ªä½ç‚¹ä¹‹é—´æœªç©¿è¶Šä»»ä½•ä»·ä½ã€‚å»¶ä¼¸è¿™æ¡ç›´çº¿è€Œç»è¿‡æœ€é«˜ç‚¹ï¼ˆè¿™æ˜¯æŒ‡æ°´å¹³è½´ä¸Šçš„ä½ç½®è€Œè¨€ï¼‰ã€‚è¶‹åŠ¿çº¿ç»è¿‡æ‰€è€ƒè™‘çš„æœ€é«˜ç‚¹ä»¥åï¼Œå®ƒå¯èƒ½ç©¿è¶ŠæŸäº›ä»·ä½ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯è¶‹åŠ¿å‘ç”Ÿå˜åŒ–çš„ä¸€ç§ç°è±¡ã€‚</li>
<li>ä¸‹é™è¶‹åŠ¿çº¿ï¼šåœ¨è€ƒè™‘çš„æ—¶é—´å†…ï¼Œä»¥æœ€é«˜çš„é«˜ç‚¹ä¸ºèµ·ç‚¹ï¼Œå‘å³ä¸‹æ–¹ç»˜åˆ¶ä¸€æ¡ç›´çº¿ï¼Œè¿æ¥æœ€ä½ç‚¹å‰çš„æŸä¸€ä¸ªé«˜ç‚¹ï¼Œè€Œä½¿è¿™æ¡ç›´çº¿åœ¨ä¸¤ä¸ªé«˜ç‚¹ä¹‹é—´æœªç©¿è¶Šä»»ä½•ä»·ä½ã€‚å»¶ä¼¸è¿™æ¡ç›´çº¿è€Œç»è¿‡æœ€ä½ç‚¹ã€‚</li>
</ol>
<p>è¿™ä¸ªæ–¹æ³•çš„ä¼˜ç‚¹åœ¨äºå…¶æ˜ç¡®æ€§ï¼Œå¹¶å¯ä»¥ç”¨æ¥åˆ¤æ–­è¶‹åŠ¿æ˜¯å¦å¯èƒ½å˜åŠ¨æˆ–å·²ç»å˜åŠ¨ã€‚</p>
<h2 id="ç¡®ç«‹è¶‹åŠ¿å˜åŠ¨çš„-123-æ³•åˆ™"><a href="#ç¡®ç«‹è¶‹åŠ¿å˜åŠ¨çš„-123-æ³•åˆ™" class="headerlink" title="ç¡®ç«‹è¶‹åŠ¿å˜åŠ¨çš„ 123 æ³•åˆ™"></a>ç¡®ç«‹è¶‹åŠ¿å˜åŠ¨çš„ 123 æ³•åˆ™</h2><ul>
<li>è‚¡ä»·çªç ´è¶‹åŠ¿çº¿</li>
<li>ä¸Šå‡è¶‹åŠ¿å›æ¡£åï¼Œä¸åˆ›æ–°é«˜ï¼›ä¸‹é™è¶‹åŠ¿åå¼¹åï¼Œä¸åˆ›æ–°ä½</li>
<li>ä¸Šå‡è¶‹åŠ¿è·Œç ´ä¸Šä¸€ä¸ªå›æ¡£ä½ç‚¹ï¼Œä¸‹é™è¶‹åŠ¿çªç ´ä¸Šä¸€ä¸ªåå¼¹é«˜ç‚¹</li>
</ul>
<h2 id="é£é™©æŠ¥é…¬æ¯”å¾ˆä¸é”™çš„-2Bæ³•åˆ™"><a href="#é£é™©æŠ¥é…¬æ¯”å¾ˆä¸é”™çš„-2Bæ³•åˆ™" class="headerlink" title="é£é™©æŠ¥é…¬æ¯”å¾ˆä¸é”™çš„ 2Bæ³•åˆ™"></a>é£é™©æŠ¥é…¬æ¯”å¾ˆä¸é”™çš„ 2Bæ³•åˆ™</h2><p>ä¸Šå‡è¶‹åŠ¿ä¸­ä»·æ ¼åˆ›æ–°é«˜åï¼Œå¹¶æœªæŒç»­ä¸Šæ¶¨ï¼Œè€Œååˆè·Œç ´å…ˆå‰çš„é«˜ç‚¹ï¼Œåˆ™è¶‹åŠ¿å¾ˆå¯èƒ½åè½¬ã€‚</p>
<h2 id="å…·æœ‰ç»Ÿè®¡å­¦ä¼˜åŠ¿çš„å››å¤©å‡†åˆ™"><a href="#å…·æœ‰ç»Ÿè®¡å­¦ä¼˜åŠ¿çš„å››å¤©å‡†åˆ™" class="headerlink" title="å…·æœ‰ç»Ÿè®¡å­¦ä¼˜åŠ¿çš„å››å¤©å‡†åˆ™"></a>å…·æœ‰ç»Ÿè®¡å­¦ä¼˜åŠ¿çš„å››å¤©å‡†åˆ™</h2><p>åœ¨ä¸­æœŸèµ°åŠ¿ä¸­ï¼Œå½“å¸‚åœºåœ¨é«˜ç‚¹æˆ–è€…ä½ç‚¹ä»¥è¿ç»­å››å¤©ä¸‹è·Œæˆ–ä¸Šæ¶¨çš„èµ°åŠ¿è€Œå‘ˆ<strong>åè½¬</strong>æ—¶ï¼Œè¶‹åŠ¿å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ ï¼ˆå’Œè¶‹åŠ¿æ–¹å‘ç›¸åçš„è¿ç»­å››æ ¹Kçº¿ï¼‰</p>
<h2 id="å››å¤©å‡†åˆ™è¾…åŠ©å‡†åˆ™"><a href="#å››å¤©å‡†åˆ™è¾…åŠ©å‡†åˆ™" class="headerlink" title="å››å¤©å‡†åˆ™è¾…åŠ©å‡†åˆ™"></a>å››å¤©å‡†åˆ™è¾…åŠ©å‡†åˆ™</h2><p>å½“ä¸­æœŸèµ°åŠ¿å‘å±•åˆ°ç›¸å½“ç¨‹åº¦ä»¥åï¼Œå¦‚æœå‡ºç°é¡ºåŠ¿çš„å››å¤©ï¼ˆæˆ–è€…ä»¥ä¸Šï¼‰æ’åˆ—ï¼Œéšåå‡ºç°ç¬¬ä¸€å¤©çš„é€†è¶‹åŠ¿è¡Œæƒ…ï¼Œç»å¸¸ä»£è¡¨è¶‹åŠ¿å˜åŠ¨çš„é¡¶éƒ¨æˆ–è€…åº•éƒ¨ã€‚</p>
<h2 id="ä¸‰å¤©é«˜ä½ä»·å‡†åˆ™"><a href="#ä¸‰å¤©é«˜ä½ä»·å‡†åˆ™" class="headerlink" title="ä¸‰å¤©é«˜ä½ä»·å‡†åˆ™"></a>ä¸‰å¤©é«˜ä½ä»·å‡†åˆ™</h2><p>ä¸‰å¤©çš„é«˜ä½ä»·å‡†åˆ™ï¼Œæ˜¯è¿ç”¨æœ€è¿‘ä¸‰å¤©çš„ç›˜ä¸­é«˜ä»·ä¸ä½ä»·ã€‚å½“ä»·æ ¼å‘ç”Ÿåè½¬è€Œç©¿è¶Šä¸‰å¤©çš„é«˜ä»·æˆ–ä½ä»·æ—¶ï¼Œåˆ™åšå¤šæˆ–å–ç©ºï¼Œå¹¶ä»¥ç¬¬ä¸‰å¤©çš„ä½ä»·æˆ–é«˜ä»·ä½œä¸ºæ­¢æŸç‚¹ã€‚ <strong>è¿™ä¸ªå‡†åˆ™å¿…é¡»é…åˆå¦ä¸€ä¸ªç¡®è®¤åŸåˆ™ã€‚</strong></p>
<h2 id="ç¼ºå£å‡†åˆ™"><a href="#ç¼ºå£å‡†åˆ™" class="headerlink" title="ç¼ºå£å‡†åˆ™"></a>ç¼ºå£å‡†åˆ™</h2><p>ç¼ºå£å‡†åˆ™å¾ˆç®€å•ï¼Œå½“è¶‹åŠ¿çº¿ä¸Šæ–¹æˆ–è€…ä¸‹æ–¹å‡ºç°ç¼ºå£æ—¶ï¼Œå®ƒåæ˜ é‡å¤§å˜åŒ–ï¼ˆæ¶ˆæ¯é¢æˆ–åŸºæœ¬é¢ï¼‰ï¼Œå¹¶æ˜¾ç¤ºè¶‹åŠ¿å¯èƒ½å‘ç”Ÿå˜åŠ¨ã€‚è¯¥å‡†åˆ™å¹¶ä¸éœ€è¦2Bï¼Œä¹Ÿä¸éœ€è¦ç»è¿‡è¯•æ¢ï¼ˆè¶‹åŠ¿çº¿ï¼‰ã€‚<br>ç„¶è€Œï¼Œç¼ºå£å¿…é¡»ç©¿è¶Šè¶‹åŠ¿çº¿ï¼Œè¯¥å‡†åˆ™æ‰æœ‰æ•ˆã€‚ <strong>è¿™ä¸ªå‡†åˆ™å¿…é¡»é…åˆå¦ä¸€ä¸ªç¡®è®¤åŸåˆ™ã€‚</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/08/23/winafl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/23/winafl/" class="post-title-link" itemprop="url">winafl fuzz å·¥å…·çš„ä½¿ç”¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-23 00:00:00" itemprop="dateCreated datePublished" datetime="2022-08-23T00:00:00+08:00">2022-08-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0-ä¸‹è½½-Visual-Studio-Community-2022"><a href="#0-ä¸‹è½½-Visual-Studio-Community-2022" class="headerlink" title="0. ä¸‹è½½ Visual Studio Community 2022"></a>0. ä¸‹è½½ Visual Studio Community 2022</h2><p>ä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://aka.ms/vs/17/release/vs_community.exe">https://aka.ms/vs/17/release/vs_community.exe</a></p>
<p>ä»å¾®è½¯ç½‘ç«™ä¸‹è½½å¹¶å®‰è£… Visual Studio Community çš„æ—¶å€™é€Ÿåº¦åªæœ‰2 Kï¼Œä¸€ä¸‹åˆæ²¡èƒ½ä¸‹è½½æˆåŠŸã€‚å’¨è¯¢åŒäº‹å°é’»é£ï¼ŒæŒ‡å‡ºå¯èƒ½æ˜¯ DNS é—®é¢˜ï¼Œå°† DNS åˆ‡æ¢æˆé˜¿é‡Œçš„ DNS 223.5.5.5 åä¸‹è½½é€Ÿåº¦è¾¾åˆ° 4 Mã€‚ä¸­å›½å¼€å‘è€…ç½‘ç»œæ€»æ˜¯ä¸ªé—®é¢˜ï¼Œå¤§å®¶éƒ½æŒºä¸å®¹æ˜“çš„ã€‚</p>
<h2 id="1-ç¼–è¯‘-winafl"><a href="#1-ç¼–è¯‘-winafl" class="headerlink" title="1. ç¼–è¯‘ winafl"></a>1. ç¼–è¯‘ winafl</h2><ol>
<li>ä¸‹è½½ DynamoRIOï¼Œ<a target="_blank" rel="noopener" href="https://github.com/DynamoRIO/dynamorio/releases/download/cronbuild-9.0.19209/DynamoRIO-Windows-9.0.19209.zip">https://github.com/DynamoRIO/dynamorio/releases/download/cronbuild-9.0.19209/DynamoRIO-Windows-9.0.19209.zip</a> è§£å‹åˆ° D:\DynamoRIO</li>
<li>ä¸‹è½½ cmakeï¼Œ<a target="_blank" rel="noopener" href="https://github.com/Kitware/CMake/releases/download/v3.24.0/cmake-3.24.0-windows-x86_64.zip">https://github.com/Kitware/CMake/releases/download/v3.24.0/cmake-3.24.0-windows-x86_64.zip</a> è§£å‹åˆ° D:\cmake</li>
<li>ä» Github ä¸‹è½½ winafl æºç  <a target="_blank" rel="noopener" href="https://github.com/googleprojectzero/winafl.git">https://github.com/googleprojectzero/winafl.git</a>  ï¼Œ ç¼–è¯‘ intel PT éœ€è¦åŒæ­¥ third_party çš„æºç </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/googleprojectzero/winafl.git</span><br><span class="line"><span class="built_in">cd</span> winafl</span><br><span class="line">git submodule update --init --recursive</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ä»èœå•ä¸­é€‰æ‹©  <code>X64 native tool command prompt for VS 2022</code>ï¼Œæ‰§è¡Œç¼–è¯‘å‘½ä»¤</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir build64</span><br><span class="line">cd build64</span><br><span class="line">D:\cmake\bin\cmake.exe -G&quot;Visual Studio 17 2022&quot; -A x64 .. -DDynamoRIO_DIR=D:\DynamoRIO\cmake -DINTELPT=1</span><br><span class="line">D:\cmake\cmake.exe --build . --config Release</span><br></pre></td></tr></table></figure>

<p><code>-DINTelPT=1</code>  å‚æ•°å°†ç¼–è¯‘ Intel PT æ¨¡å¼çš„æ”¯æŒï¼Œç¼–è¯‘å®Œæˆåï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">.\build64\bin\Release&gt;.\afl-fuzz.exe</span><br><span class="line"></span><br><span class="line">WinAFL 1.16b by &lt;ifratric@google.com&gt;</span><br><span class="line">Based on AFL 2.43b by &lt;lcamtuf@google.com&gt;</span><br><span class="line"></span><br><span class="line">.\afl-fuzz.exe [ afl options ] -- [instrumentation options] -- \path\to\fuzzed_app [ ... ]</span><br><span class="line"></span><br><span class="line">Required parameters:</span><br><span class="line"></span><br><span class="line">  -i dir        - input directory with test cases</span><br><span class="line">  -o dir        - output directory for fuzzer findings</span><br><span class="line">  -t msec       - timeout for each run</span><br><span class="line"></span><br><span class="line">Instrumentation type:</span><br><span class="line"></span><br><span class="line">  -D dir       - directory with DynamoRIO binaries (drrun, drconfig)</span><br><span class="line">  -w winafl    - Path to winafl.dll</span><br><span class="line">  -P           - use Intel PT tracing mode</span><br><span class="line">  -Y           - enable the static instrumentation mode</span><br><span class="line"></span><br><span class="line">Execution control settings:</span><br><span class="line"></span><br><span class="line">  -f file       - location read by the fuzzed program (stdin)</span><br><span class="line">  -m limit      - memory limit for the target process</span><br><span class="line">  -p            - persist DynamoRIO cache across target process restarts</span><br><span class="line">  -c cpu        - the CPU to run the fuzzed program</span><br><span class="line"></span><br><span class="line">Fuzzing behavior settings:</span><br><span class="line"></span><br><span class="line">  -d            - quick &amp; dirty mode (skips deterministic steps)</span><br><span class="line">  -n            - fuzz without instrumentation (dumb mode)</span><br><span class="line">  -x dir        - optional fuzzer dictionary (see README)</span><br><span class="line"></span><br><span class="line">Other stuff:</span><br><span class="line"></span><br><span class="line">  -I msec       - timeout for process initialization and first run</span><br><span class="line">  -T text       - text banner to show on the screen</span><br><span class="line">  -M \ -S id   - distributed mode (see parallel_fuzzing.txt)</span><br><span class="line">  -C            - crash exploration mode (the peruvian rabbit thing)</span><br><span class="line">  -e            - expert mode to run WinAFL as a DynamoRIO tool</span><br><span class="line">  -l path       - a path to user-defined DLL for custom test cases processing</span><br><span class="line">  -V            - show version number and exit</span><br><span class="line"></span><br><span class="line">Attach:</span><br><span class="line"></span><br><span class="line">  -A module     - attach to the process that loaded the provided module</span><br><span class="line"></span><br><span class="line">For additional tips, please consult afl_docs\README.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\zhouzhen\Downloads\winafl\build64\bin\Release&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-æ£€æŸ¥-DynamoRIO-æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œ"><a href="#2-æ£€æŸ¥-DynamoRIO-æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œ" class="headerlink" title="2. æ£€æŸ¥ DynamoRIO æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œ"></a>2. æ£€æŸ¥ DynamoRIO æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œ</h2><p>ä½¿ç”¨ IDA Pro å¯¹ test_gdiplus.exe è¿›è¡Œåæ±‡ç¼–ï¼Œtarget_offset ä¸º <code>0x10E0</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000001400010E0 ; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">.text:00000001400010E0 main            proc near               ; CODE XREF: __scrt_common_main_seh(void)+107â†“p</span><br><span class="line">.text:00000001400010E0                                         ; DATA XREF: .rdata:0000000140002B6Câ†“o ...</span><br></pre></td></tr></table></figure>

<p>å…ˆç”¨ drrun.exe æµ‹è¯• winafl æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå…¶å®å°±æ˜¯å¾ªç¯æ‰§è¡Œ 10 æ¬¡ç›®æ ‡ç¨‹åºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\DynamoRIO\bin64\drrun.exe -c winafl.dll -debug ^</span><br><span class="line">-target_module test_gdiplus.exe -target_offset 0x10E0 -fuzz_iterations 10 ^</span><br><span class="line">-nargs 2 -- test_gdiplus.exe input.bmp</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå‘½ä»¤åï¼Œåœ¨å½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª log æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸º <code>afl.test_gdiplus.exe.14172.0000.proc.log</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">Module loaded, dynamorio.dll</span><br><span class="line">Module loaded, winafl.dll</span><br><span class="line">Module loaded, drx.dll</span><br><span class="line">Module loaded, drreg.dll</span><br><span class="line">Module loaded, drmgr.dll</span><br><span class="line">Module loaded, drwrap.dll</span><br><span class="line">Module loaded, test_gdiplus.exe</span><br><span class="line">Module loaded, gdiplus.dll</span><br><span class="line">Module loaded, VCRUNTIME140.dll</span><br><span class="line">Module loaded, msvcp_win.dll</span><br><span class="line">Module loaded, win32u.dll</span><br><span class="line">Module loaded, ucrtbase.dll</span><br><span class="line">Module loaded, KERNELBASE.dll</span><br><span class="line">Module loaded, gdi32full.dll</span><br><span class="line">Module loaded, KERNEL32.dll</span><br><span class="line">Module loaded, msvcrt.dll</span><br><span class="line">Module loaded, IMM32.dll</span><br><span class="line">Module loaded, RPCRT4.dll</span><br><span class="line">Module loaded, GDI32.dll</span><br><span class="line">Module loaded, combase.dll</span><br><span class="line">Module loaded, USER32.dll</span><br><span class="line">Module loaded, ntdll.dll</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">Module loaded, UxTheme.dll</span><br><span class="line">Module loaded, OLEAUT32.dll</span><br><span class="line">Module loaded, bcrypt.dll</span><br><span class="line">Module loaded, SECHOST.dll</span><br><span class="line">Module loaded, ADVAPI32.dll</span><br><span class="line">Module loaded, WindowsCodecs.dll</span><br><span class="line">Module loaded, MSCTF.dll</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">In pre_fuzz_handler</span><br><span class="line">In post_fuzz_handler</span><br><span class="line">Everything appears to be running normally.</span><br><span class="line">Coverage map follows:</span><br><span class="line">                                            </span><br></pre></td></tr></table></figure>

<p><code>Everything appears to be running normally.</code> è¡¨æ˜ winafl è‡ªå·±è®¤ä¸ºæ²¡æœ‰å‡ºé”™ã€‚ log æ–‡ä»¶ä¸­è¿˜åŒ…å«äº†å…¶ä»–æœ‰ç”¨ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ç›®æ ‡ç¨‹åºåŠ è½½çš„æ¨¡å—ã€‚è¿™äº›åŠ è½½çš„æ¨¡å—å¯ä»¥ç”¨æ¥è®¾ç½® <code>-coverage_module</code>æ¥ç»Ÿè®¡ä½ æ‰€å…³æ³¨çš„ coverageã€‚</p>
<p>ä½¿ç”¨ drrun.exe éªŒè¯æˆåŠŸåï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤æµ‹è¯• winafl æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmd &gt; afl-fuzz.exe -i <span class="keyword">in</span> -o out -D D:\DynamoRIO\bin64 -t 20000 ^</span><br><span class="line">-- -coverage_module gdiplus.dll -coverage_module WindowsCodecs.dll -fuzz_iterations 5000 ^</span><br><span class="line">-target_module test_gdiplus.exe -target_offset 0x10E0 -nargs 2 -- test_gdiplus.exe @@</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œåä¸Šé¢çš„å‘½ä»¤åï¼Œå¦‚æœå‘ç° total paths çš„æ•°å­—åœ¨ä¸æ–­å˜åŒ–ï¼Œ winafl å°±å·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼Œæ­å–œ ğŸ˜„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">+- process timing -------------------------------------+- overall results ----+</span><br><span class="line">|        run time : 0 days, 0 hrs, 0 min, 1 sec        |  cycles done : 0     |</span><br><span class="line">|   last new path : 0 days, 0 hrs, 0 min, 1 sec        |  total paths : 2     |</span><br><span class="line">| last uniq crash : none seen yet                      | uniq crashes : 0     |</span><br><span class="line">|  last uniq hang : none seen yet                      |   uniq hangs : 0     |</span><br><span class="line">+- cycle progress --------------------+- map coverage -+----------------------+</span><br><span class="line">|  now processing : 0 (0.00%)         |    map density : 1.65% / 1.65%        |</span><br><span class="line">| paths timed out : 0 (0.00%)         | count coverage : 1.00 bits/tuple      |</span><br><span class="line">+- stage progress --------------------+ findings in depth --------------------+</span><br><span class="line">|  now trying : arith 8\8             | favored paths : 1 (50.00%)            |</span><br><span class="line">| stage execs : 388/389 (99.74%)      |  new edges on : 2 (100.00%)           |</span><br><span class="line">| total execs : 619                   | total crashes : 0 (0 unique)          |</span><br><span class="line">|  exec speed : 353.3/sec             |  total tmouts : 0 (0 unique)          |</span><br><span class="line">+- fuzzing strategy yields -----------+---------------+- path geometry -------+</span><br><span class="line">|   bit flips : 0/56, 1/55, 0/53                      |    levels : 2         |</span><br><span class="line">|  byte flips : 0/7, 0/6, 0/4                         |   pending : 2         |</span><br><span class="line">| arithmetics : 0/0, 0/0, 0/0                         |  pend fav : 1         |</span><br><span class="line">|  known ints : 0/0, 0/0, 0/0                         | own finds : 1         |</span><br><span class="line">|  dictionary : 0/0, 0/0, 0/0                         |  imported : n/a       |</span><br><span class="line">|       havoc : 0/0, 0/0                              | stability : 99.63%    |</span><br><span class="line">|        trim : 0.00%/1, 0.00%                        +-----------------------+</span><br><span class="line">^C----------------------------------------------------+   [cpu000001:  14%]</span><br></pre></td></tr></table></figure>

<h2 id="3-DynamoRIO-æ¨¡å¼-winafl-dll-å„ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰"><a href="#3-DynamoRIO-æ¨¡å¼-winafl-dll-å„ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰" class="headerlink" title="3. DynamoRIO æ¨¡å¼ winafl.dll å„ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰"></a>3. DynamoRIO æ¨¡å¼ winafl.dll å„ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰</h2><p>winafl.dll æ˜¯ DynamoRIO client (instrumentation) codeï¼Œå‚æ•°æŒºå¤š Winafl çš„ README ä¸­ä»‹ç»äº†ä¸‹é¢è¿™äº›å‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">-covtype         - the type of coverage being recorded. Supported options are</span><br><span class="line">                   bb (basic block, default) or edge.</span><br><span class="line"></span><br><span class="line">-coverage_module - module for which to record coverage. Multiple module flags</span><br><span class="line">                   are supported.</span><br><span class="line"></span><br><span class="line">-target_module   - module which contains the target function to be fuzzed.</span><br><span class="line">                   Either -target_method or -target_offset need to be</span><br><span class="line">                   specified together with this option.</span><br><span class="line"></span><br><span class="line">-target_method   - name of the method to fuzz in persistent mode. For this to</span><br><span class="line">                   work either the method needs to be exported or the symbols</span><br><span class="line">                   for target_module need to be available. Otherwise use</span><br><span class="line">                   -target_offset instead.</span><br><span class="line"></span><br><span class="line">-target_offset   - offset of the method to fuzz from the start of the module.</span><br><span class="line"></span><br><span class="line">-fuzz_iterations - Maximum number of iterations for the target function to run</span><br><span class="line">                   before restarting the target process.</span><br><span class="line"></span><br><span class="line">-nargs           - Number of arguments the fuzzed method takes. This is used</span><br><span class="line">                   to save/restore the arguments between runs.</span><br><span class="line"></span><br><span class="line">-call_convention - The default calling convention is cdecl on 32-bit x86</span><br><span class="line">                   platforms and Microsoft x64 for Visual Studio 64-bit</span><br><span class="line">                   applications. Possible values:</span><br><span class="line">                       * fastcall: fastcall</span><br><span class="line">                       * ms64: Microsoft x64 (Visual Studio)</span><br><span class="line">                       * stdcall: cdecl or stdcall</span><br><span class="line">                       * thiscall: thiscall</span><br><span class="line"></span><br><span class="line">-debug           - Debug mode. Does not try to connect to the server. Outputs</span><br><span class="line">                   a log file containing loaded modules, opened files and</span><br><span class="line">                   coverage information.</span><br><span class="line"></span><br><span class="line">-logdir          - specifies in which directory the log file will be written</span><br><span class="line">                   (only to be used with -debug).</span><br><span class="line"></span><br><span class="line">-thread_coverage - If set, WinAFL will only collect coverage from a thread</span><br><span class="line">                   that executed the target function</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-nargs</code> target method æˆ–è€… target offset çš„å‚æ•°ä¸ªæ•°</li>
<li><code>-fuzz_iterations</code> é‡å¯è¿›ç¨‹å‰ï¼Œå¾ªç¯æ‰§è¡Œ target method æˆ–è€… target offset çš„æ¬¡æ•°</li>
<li><code>-target_moudle</code> fuzz çš„ç›®æ ‡æ¨¡å—ï¼Œéœ€è¦å’Œ target method æˆ–è€… target offset ä¸€èµ·ä½¿ç”¨</li>
<li><code>-target_method</code> persistent mode ä¸‹ fuzz çš„å‡½æ•°åï¼ˆæ–¹æ³•åï¼‰ï¼Œéœ€è¦æœ‰ç¬¦å· ï¼ˆsymbolsï¼‰</li>
<li><code>-target_offset</code> fuzz çš„å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰ç›¸å¯¹äºæ¨¡å—èµ·å§‹åœ°å€çš„åç§»</li>
<li><code>-coverage_module</code> ç»Ÿè®¡è¦†ç›–ç‡çš„æ¨¡å—ï¼Œå¯ä»¥ç»Ÿè®¡å¤šä¸ªæ¨¡å—çš„ coverageï¼Œå³æŒ‡å®šå¤šä¸ª -coverage_module å‚æ•°</li>
<li><code>-covtype</code> bb æˆ–è€… edgeï¼Œbb ï¼ˆbasic block ä¸ºé»˜è®¤å€¼ï¼‰</li>
<li><code> -thread_coverage</code> ç”¨äºå¤šçº¿ç¨‹ç¨‹åºï¼Œåªç»Ÿè®¡ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ target function çš„è¦†ç›–ç‡å˜åŒ–</li>
</ul>
<h2 id="4-WinAFL-intel-PT-æ¨¡å¼ä½¿ç”¨"><a href="#4-WinAFL-intel-PT-æ¨¡å¼ä½¿ç”¨" class="headerlink" title="4. WinAFL intel PT æ¨¡å¼ä½¿ç”¨"></a>4. WinAFL intel PT æ¨¡å¼ä½¿ç”¨</h2><p>Intel PT (Processor Tracing) æ˜¯ Intel CPU çš„ä¸€ä¸ªç‰¹æ€§ï¼Œä» Intel ç¬¬5ä»£å¤„ç†å™¨å¼€å§‹æ”¯æŒï¼Œ5th generation çš„å¾®æ¶æ„ä¸º <code>Broadwell</code>ã€‚ç›¸å…³è¯´æ˜å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/support/articles/000056730/processors.html">https://www.intel.com/content/www/us/en/support/articles/000056730/processors.html</a></p>
<p>Windows 10 ä» v1809 å¼€å§‹æä¾›äº† Intel PT çš„é©±åŠ¨ï¼Œä½†ç›®å‰æ²¡æœ‰å…¬å¼€çš„æ–‡æ¡£æè¿°æ­¤é©±åŠ¨ï¼Œä¹Ÿæ²¡æœ‰æä¾›å®˜æ–¹çš„ APIã€‚Â Alex Ionescu æä¾›äº† <a target="_blank" rel="noopener" href="https://github.com/ionescu007/winipt">winipt</a> library å’Œ Intel PT é©±åŠ¨äº¤äº’ï¼ŒWinAFL åˆ©ç”¨ winipt æ¥è·å¾— Intel PT çš„ Processo Tracing ä¿¡æ¯ã€‚</p>
<p>WinAFL ä½¿ç”¨ Intel PT æ¨¡å¼ï¼Œå’Œ DynamoRIO ä¸åŒéœ€è¦æŒ‡å®š <code>-P</code> , WinAFL Intel PT æ¨¡å¼é™¤äº†å’ŒDynamoRIO ç›¸åŒçš„å‚æ•°å¤–é¢å¤–æ·»åŠ äº†ä¸‹é¢å‡ ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>-trace_size</code> æ¯æ¬¡æ‰§è¡Œ traget æ‰‹æœºçš„ trace ä¿¡æ¯çš„å­—èŠ‚æ•°ï¼Œå¿…é¡»æ˜¯2 çš„æ¬¡æ–¹å¹¶ä¸”å¤§äº 4096</li>
<li><code>-decode</code> å¤„ç† trace ä¿¡æ¯çš„è§£ç å™¨ï¼Œæœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼š<code>tip</code>,  <code>tip_ref</code> å’Œ <code>full</code> (full ä¸ºé»˜è®¤å€¼)</li>
<li><code>-nopersistent_trace</code> ç”±äºæ€§èƒ½çš„ç¼˜æ•…ï¼ŒWinAFL æ¯æ¬¡å¾ªç¯æ‰§è¡Œ target æ˜¯ä¸é‡å¯ç¨‹åºï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥å¼ºåˆ¶ WinAFL æ¯æ¬¡æ‰§è¡Œ target éƒ½é‡å¯ï¼Œä¸€èˆ¬æ˜¯ä¸ºäº†è°ƒè¯•æ‰ä¼šå¯ç”¨è¿™ä¸ªé€‰é¡¹</li>
<li><code>-trace_cache_size</code>  trace ä¿¡æ¯çš„ cache å­—èŠ‚æ•°ï¼Œå’Œ <code>full</code> è§£ç å™¨ä¸€èµ·ä½¿ç”¨</li>
</ul>
<h2 id="5-æ£€æŸ¥-Intel-PT-æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œ"><a href="#5-æ£€æŸ¥-Intel-PT-æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œ" class="headerlink" title="5 æ£€æŸ¥ Intel PT æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œ"></a>5 æ£€æŸ¥ Intel PT æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winaflpt-debug.exe -debug -coverage_module test_gdiplus.exe -fuzz_iterations 10 ^</span><br><span class="line">-target_module test_gdiplus.exe -target_offset 0x10E0 -nargs 2 -- test_gdiplus.exe @@</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å‘½ä»¤å…¶å®å’Œæ£€æŸ¥ DynamoRIO æ¨¡å¼æ˜¯å¦æ­£å¸¸å·¥ä½œçš„å‘½ä»¤åŸºæœ¬ä¸€ç›´ï¼Œæ‰§è¡Œå‘½ä»¤åè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Module loaded: test_gdiplus.exe</span><br><span class="line">Module loaded: ntdll.dll</span><br><span class="line">Module loaded: KERNEL32.DLjL</span><br><span class="line">Module loaded: KERNELBASE.dll</span><br><span class="line">Module loaded: ucrtbase.dll</span><br><span class="line">Module loaded: gdiplus.dll</span><br><span class="line">Module loaded: msvcrt.dll</span><br><span class="line">Module loaded: combase.dll</span><br><span class="line">Module loaded: VCRUNTIME140.dll</span><br><span class="line">Module loaded: RPCRT4.dll</span><br><span class="line">Module loaded: USER32.dll</span><br><span class="line">Module loaded: win32u.dll</span><br><span class="line">Module loaded: GDI32.dll</span><br><span class="line">Module loaded: gdi32full.dll</span><br><span class="line">Module loaded: msvcp_win.dll</span><br><span class="line">Module loaded: IMM32.DLL</span><br><span class="line">iteration 0</span><br><span class="line">Module loaded: uxtheme.dll</span><br><span class="line">Module loaded: msctf.dll</span><br><span class="line">Module loaded: oleaut32.dll</span><br><span class="line">Module loaded: sechost.dll</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 1</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 2</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 3</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 4</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 5</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 6</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 7</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 8</span><br><span class="line">Iteration finished normally</span><br><span class="line">iteration 9</span><br><span class="line">Iteration finished normally</span><br><span class="line">Coverage map (hex): </span><br><span class="line">00000000000000000000000000000000</span><br><span class="line">00000000000000000000000000000000</span><br></pre></td></tr></table></figure>

<h2 id="6-ç”¨-Intel-PT-æ¨¡å¼-fuzz"><a href="#6-ç”¨-Intel-PT-æ¨¡å¼-fuzz" class="headerlink" title="6. ç”¨ Intel PT æ¨¡å¼ fuzz"></a>6. ç”¨ Intel PT æ¨¡å¼ fuzz</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz.exe -i in -o out -P -t 20000 -- -coverage_module test_gdiplus.exe -fuzz_iterations 10 -target_module test_gdiplus.exe -target_offset 0x10E0 -nargs 2 -- test_gdiplus.exe @@</span><br></pre></td></tr></table></figure>

<p>ç”¨ä¸Šé¢çš„å‘½ä»¤è°ƒç”¨ afl-fuzzï¼Œå‘ç°å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œç•Œé¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">               WinAFL 1.16b based on AFL 2.43b (test_gdiplus.exe)</span><br><span class="line"></span><br><span class="line">+- process timing -------------------------------------+- overall results ----+</span><br><span class="line">|        run time : 0 days, 0 hrs, 0 min, 13 sec       |  cycles done : 10    |</span><br><span class="line">|   last new path : none yet (odd, check syntax!)      |  total paths : 1     |</span><br><span class="line">| last uniq crash : none seen yet                      | uniq crashes : 0     |</span><br><span class="line">|  last uniq hang : none seen yet                      |   uniq hangs : 0     |</span><br><span class="line">+- cycle progress --------------------+- map coverage -+----------------------+</span><br><span class="line">|  now processing : 0 (0.00%)         |    map density : 0.04% / 0.04%        |</span><br><span class="line">| paths timed out : 0 (0.00%)         | count coverage : 1.07 bits/tuple      |</span><br><span class="line">+- stage progress --------------------+ findings in depth --------------------+</span><br><span class="line">|  now trying : havoc                 | favored paths : 1 (100.00%)           |</span><br><span class="line">| stage execs : 48/128 (37.50%)       |  new edges on : 1 (100.00%)           |</span><br><span class="line">| total execs : 2207                  | total crashes : 0 (0 unique)          |</span><br><span class="line">|  exec speed : 160.8/sec             |  total tmouts : 0 (0 unique)          |</span><br><span class="line">+- fuzzing strategy yields -----------+---------------+- path geometry -------+</span><br><span class="line">|   bit flips : 0/32, 0/31, 0/29                      |    levels : 1         |</span><br><span class="line">|  byte flips : 0/4, 0/3, 0/1                         |   pending : 0         |</span><br><span class="line">| arithmetics : 0/222, 0/2, 0/0                       |  pend fav : 0         |</span><br><span class="line">|  known ints : 0/19, 0/102, 0/40                     | own finds : 0         |</span><br><span class="line">|  dictionary : 0/0, 0/0, 0/0                         |  imported : n/a       |</span><br><span class="line">|       havoc : 0/1664, 0/0                           | stability : 100.00%   |</span><br><span class="line">|        trim : 42.86%/1, 0.00%                       +-----------------------+</span><br><span class="line">^C----------------------------------------------------+   [cpu000001:  18%]</span><br></pre></td></tr></table></figure>


<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://github.com/googleprojectzero/winafl/blob/master/README.md">https://github.com/googleprojectzero/winafl/blob/master/README.md</a><br><a target="_blank" rel="noopener" href="https://github.com/googleprojectzero/winafl/blob/master/readme_dr.md">https://github.com/googleprojectzero/winafl/blob/master/readme_dr.md</a><br><a target="_blank" rel="noopener" href="https://github.com/googleprojectzero/winafl/blob/master/readme_pt.md">https://github.com/googleprojectzero/winafl/blob/master/readme_pt.md</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/07/21/2022-07-21-When-Hypervisor-Met-Snapshot-Fuzzing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/21/2022-07-21-When-Hypervisor-Met-Snapshot-Fuzzing/" class="post-title-link" itemprop="url">When Hypervisor Met Snapshot Fuzzing</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-21 16:00:00" itemprop="dateCreated datePublished" datetime="2022-07-21T16:00:00+08:00">2022-07-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>source: <a target="_blank" rel="noopener" href="https://null2root.github.io/blog/2022/07/21/When-Hypervisor-Met-Snapshot-Fuzzing.html">https://null2root.github.io/blog/2022/07/21/When-Hypervisor-Met-Snapshot-Fuzzing.html</a></p>
<h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><p>Hypervisor was known as hard target to fuzz over several years. Even though, lots of prior pioneers( <a target="_blank" rel="noopener" href="https://rezer0dai.github.io/biug-bounties/">Peter Hlavaty</a>, <a target="_blank" rel="noopener" href="https://conference.hitb.org/hitbsecconf2021ams/materials/D2T2%20-%20Discovering%2010+%20Vulnerabilities%20in%20Virtualbox%20-%20Chen%20Nan.pdf">Chaitin Tech</a>, <a target="_blank" rel="noopener" href="https://starlabs.sg/blog/2020/04-adventures-in-hypervisor-oracle-virtualbox-research/#coverage-guided-fuzzing">StarLabs</a>, <a target="_blank" rel="noopener" href="https://github.com/SafeBreach-Labs/hAFL2">Peleg Hadar and Ophir Harpaz</a> and many others ) doing amazing work to overcome this limit and found interesting bugs.</p>
<p>But it is not an easy topic for some fresh newbie like me to starts from the bottom. I think manual code( or binary ) auditing and static analysis could be only considerable options if I start my research a few years ago without <strong>What The Fuzz</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/0vercl0k/wtf">What The Fuzz</a>( a.k.a WTF ) is a snapshot-based fuzzer targeting Windows Ring-3 and Ring-0 component. WTFâ€™s snapshot is based on memory dump both kernel and user-land. Because of that, WTF can not emulate any functionality which requires anything not within in-memory and can not create new process or thread because memory dump limited on single process. But WTF support <a target="_blank" rel="noopener" href="https://github.com/0vercl0k/wtf/blob/4a9bf55/src/wtf/bochscpu_backend.cc#L265">breakpoint Handler</a> which you can set breakpoint on <strong>any</strong> address within memory dump and if fuzz execution reaches that address, pre-defined breakpoint handler will be executed. Based on this, we can trying to overcome some limitation on WTF such as <a target="_blank" rel="noopener" href="https://github.com/0vercl0k/wtf/blob/main/src/wtf/fshooks.cc">file access</a>.</p>
<p>I really love WTFâ€™s flexibility and its potential, and I am going to show one of example usage of WTF on targeting Virtualbox to prove how awesome it is.</p>
<h1 id="2-Developing-Fuzz-Module"><a href="#2-Developing-Fuzz-Module" class="headerlink" title="2. Developing Fuzz Module"></a>2. Developing Fuzz Module</h1><p>First, you should define your own fuzz module for your target. There are few examples on github( <a target="_blank" rel="noopener" href="https://github.com/0vercl0k/wtf/blob/main/src/wtf/fuzzer_hevd.cc">fuzzer_hevd.cc</a>, <a target="_blank" rel="noopener" href="https://github.com/0vercl0k/wtf/blob/main/src/wtf/fuzzer_tlv_server.cc">fuzzer_tlv_server.cc</a> ) and blog post( <a target="_blank" rel="noopener" href="https://blog.ret2.io/2021/07/21/wtf-snapshot-fuzzing/">ret2systems</a>, <a target="_blank" rel="noopener" href="https://doar-e.github.io/blog/2021/07/15/building-a-new-snapshot-fuzzer-fuzzing-ida/">Doar-e</a> ). </p>
<p>My Target was Virtualboxâ€™s <strong>SVGA</strong> component.</p>
<p>SVGA is something like â€œ<a target="_blank" rel="noopener" href="https://www.zerodayinitiative.com/blog/2021/1/6/mindshare-analysis-of-vmware-workstation-and-esxi-using-debug-symbols-from-flings">JavaScript of hypervisors</a>â€œ. Because of its complex nature, many hypervisor bugs are oriented by SVGA. And thatâ€™s the reason why I choose it as a first target.</p>
<p>VirtualBox have a function called <a target="_blank" rel="noopener" href="https://github.com/mdaniel/virtualbox-org-svn-vbox-trunk/blob/8fe9163/src/VBox/Devices/Graphics/DevVGA-SVGA.cpp#L4505">vmsvgaR3FifoLoop</a>. It <a target="_blank" rel="noopener" href="https://github.com/mdaniel/virtualbox-org-svn-vbox-trunk/blob/8fe9163/src/VBox/Devices/Graphics/DevVGA-SVGA.cpp#L4757">waits</a> until guest submit new command data through GPA. So this is a good spot( or should I call it <a target="_blank" rel="noopener" href="https://youtu.be/ZaOtY4i5w_U">source</a>? ) to take a snapshot.</p>
<p>I set a breakpoint on <code>vmsvgaR3FifoLoop+4E2</code> to take snapshot. It is same position as <a target="_blank" rel="noopener" href="https://github.com/mdaniel/virtualbox-org-svn-vbox-trunk/blob/8fe9163/src/VBox/Devices/Graphics/DevVGA-SVGA.cpp#L4783">here</a>, start of switch-case routine for <a target="_blank" rel="noopener" href="https://github.com/mdaniel/virtualbox-org-svn-vbox-trunk/blob/8fe9163eabe8b7a7f14f29c88c13a458f38fe25e/src/VBox/Devices/Graphics/vmsvga_include/svga_reg.h#L152">SVGA</a> and <a target="_blank" rel="noopener" href="https://github.com/mdaniel/virtualbox-org-svn-vbox-trunk/blob/8fe9163eabe8b7a7f14f29c88c13a458f38fe25e/src/VBox/Additions/3D/mesa/mesa-17.3.9/src/gallium/drivers/svga/include/svga3d_cmd.h#L56">SVGA3D</a> command.</p>
<p><img src="https://github.com/henices/pictures/raw/master/wtf-vbox-blahblah1.png" alt="blahblah1"></p>
<p>After creating snapshot, I had to decide make it <a target="_blank" rel="noopener" href="https://github.com/0vercl0k/wtf/blob/main/src/wtf/fuzzer_tlv_server.cc">run multiple times in single execution</a> or <a target="_blank" rel="noopener" href="https://github.com/0vercl0k/wtf/blob/main/src/wtf/fuzzer_hevd.cc">not</a>. Because SVGA is consist of various commands like define, update, delete somethingâ€¦, I thought fuzz campaign must handle multiple SVGA commands during single round.</p>
<p>First, I had to define structure to contains multiple testcases. Luckily, <a target="_blank" rel="noopener" href="https://twitter.com/0vercl0k">0vercl0k</a> already write <a target="_blank" rel="noopener" href="https://github.com/0vercl0k/wtf/blob/4a9bf55/src/wtf/fuzzer_tlv_server.cc#L24-L75">nice example</a> to doing that. So I did same thing as below.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SVGA_CMD_BODY_MAX 0xA000</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> SvgaCmdList[] = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">19</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">1040</span>, <span class="number">1041</span>, <span class="number">1042</span>, <span class="number">1043</span>, <span class="number">1044</span>, <span class="number">1046</span>, <span class="number">1047</span>, <span class="number">1048</span>, <span class="number">1049</span>, <span class="number">1050</span>, <span class="number">1051</span>, <span class="number">1052</span>, <span class="number">1053</span>, <span class="number">1054</span>, <span class="number">1055</span>, <span class="number">1056</span>, <span class="number">1057</span>, <span class="number">1058</span>, <span class="number">1059</span>, <span class="number">1060</span>, <span class="number">1061</span>, <span class="number">1062</span>, <span class="number">1063</span>, <span class="number">1064</span>, <span class="number">1065</span>, <span class="number">1066</span>, <span class="number">1067</span>, <span class="number">1068</span>, <span class="number">1069</span>, <span class="number">1070</span>, <span class="number">1071</span>, <span class="number">1072</span>, <span class="number">1073</span>, <span class="number">1074</span>, <span class="number">1075</span>, <span class="number">1076</span>, <span class="number">1077</span>, <span class="number">1078</span>, <span class="number">1079</span>, <span class="number">1080</span>, <span class="number">1081</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> SvgaCmdListLen = <span class="number">58</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SvgaCmd_t</span> &#123;</span><br><span class="line">  <span class="type">uint32_t</span> SvgaCmdCode;</span><br><span class="line">  std::vector&lt;<span class="type">uint8_t</span>&gt; SvgaBody;</span><br><span class="line">  <span class="built_in">NLOHMANN_DEFINE_TYPE_INTRUSIVE</span>(SvgaCmd_t, SvgaCmdCode, SvgaBody);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SvgaCmds_t</span> &#123;</span><br><span class="line">  std::vector&lt;SvgaCmd_t&gt; SvgaCmds;</span><br><span class="line">  <span class="built_in">NLOHMANN_DEFINE_TYPE_INTRUSIVE</span>(SvgaCmds_t, SvgaCmds);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> &#123;</span><br><span class="line">  std::deque&lt;SvgaCmd_t&gt; SvgaCmds;</span><br><span class="line">  CpuState_t Context;</span><br><span class="line">  <span class="type">uint8_t</span> SvgaCmdBody[SVGA_CMD_BODY_MAX];</span><br><span class="line">  <span class="type">uint32_t</span> SvgaCmdBodySize;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">RestoreGprs</span><span class="params">(Backend_t *B)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> &amp;C = Context;</span><br><span class="line">    B-&gt;<span class="built_in">Rsp</span>(C.Rsp);</span><br><span class="line">    B-&gt;<span class="built_in">Rip</span>(C.Rip);</span><br><span class="line">    B-&gt;<span class="built_in">Rax</span>(C.Rax);</span><br><span class="line">    B-&gt;<span class="built_in">Rbx</span>(C.Rbx);</span><br><span class="line">    B-&gt;<span class="built_in">Rcx</span>(C.Rcx);</span><br><span class="line">    B-&gt;<span class="built_in">Rdx</span>(C.Rdx);</span><br><span class="line">    B-&gt;<span class="built_in">Rsi</span>(C.Rsi);</span><br><span class="line">    B-&gt;<span class="built_in">Rdi</span>(C.Rdi);</span><br><span class="line">    B-&gt;<span class="built_in">R8</span>(C.R8);</span><br><span class="line">    B-&gt;<span class="built_in">R9</span>(C.R9);</span><br><span class="line">    B-&gt;<span class="built_in">R10</span>(C.R10);</span><br><span class="line">    B-&gt;<span class="built_in">R11</span>(C.R11);</span><br><span class="line">    B-&gt;<span class="built_in">R12</span>(C.R12);</span><br><span class="line">    B-&gt;<span class="built_in">R13</span>(C.R13);</span><br><span class="line">    B-&gt;<span class="built_in">R14</span>(C.R14);</span><br><span class="line">    B-&gt;<span class="built_in">R15</span>(C.R15);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; GlobalState;</span><br><span class="line"></span><br><span class="line"><span class="function">SvgaCmds_t <span class="title">Deserialize</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *Buffer, <span class="type">const</span> <span class="type">size_t</span> BufferSize)</span> </span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="keyword">auto</span> &amp;Root = json::json::<span class="built_in">parse</span>(Buffer, Buffer + BufferSize);</span><br><span class="line">  <span class="keyword">return</span> Root.<span class="built_in">get</span>&lt;SvgaCmds_t&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InsertTestcase</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *Buffer, <span class="type">const</span> <span class="type">size_t</span> BufferSize)</span> </span>&#123;</span><br><span class="line">  GlobalState.SvgaCmds.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="keyword">auto</span> &amp;Root = <span class="built_in">Deserialize</span>(Buffer, BufferSize);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> SvgaCmd : Root.SvgaCmds) &#123;</span><br><span class="line">    GlobalState.SvgaCmds.<span class="built_in">emplace_back</span>(std::<span class="built_in">move</span>(SvgaCmd));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It is almost identical as example.</p>
<p>Next question was, how can I insert data into snapshot? I had to find a insertion point and proper memory address. Luckily( again ), VirtualBox using a function called <a target="_blank" rel="noopener" href="https://github.com/mdaniel/virtualbox-org-svn-vbox-trunk/blob/8fe9163/src/VBox/Devices/Graphics/DevVGA-SVGA.cpp#L4183">vmsvgaR3FifoGetCmdPayload</a> to receive command data from guest to host. I define a breakpoint handler in <code>Init()</code> callback function as below.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// unsigned __int8 *__fastcall vmsvgaR3FifoGetCmdPayload(</span></span><br><span class="line"><span class="comment">//       unsigned int cbPayloadReq,</span></span><br><span class="line"><span class="comment">//       volatile unsigned int *pFIFO,</span></span><br><span class="line"><span class="comment">//       unsigned int offCurrentCmd,</span></span><br><span class="line"><span class="comment">//       unsigned int offFifoMin,</span></span><br><span class="line"><span class="comment">//       unsigned int offFifoMax,</span></span><br><span class="line"><span class="comment">//       unsigned __int8 *pbBounceBuf,</span></span><br><span class="line"><span class="comment">//       unsigned int *pcbAlreadyRead,</span></span><br><span class="line"><span class="comment">//       PDMTHREAD *pThread,</span></span><br><span class="line"><span class="comment">//       VGAState *pThis,</span></span><br><span class="line"><span class="comment">//       VMSVGAR3STATE *pSVGAState,</span></span><br><span class="line"><span class="comment">//       PDMDEVINSR3 *pDevIns)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">Setbreakpoint</span>(<span class="string">&quot;VBoxDD!vmsvgaR3FifoGetCmdPayload&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">  <span class="type">uint32_t</span> cbPayloadReq = Backend-&gt;<span class="built_in">GetArg</span>(<span class="number">0</span>);</span><br><span class="line">  Gva_t pbBounceBuf_gva = Backend-&gt;<span class="built_in">GetArgGva</span>(<span class="number">5</span>);</span><br><span class="line">  Gva_t pcbAlreadyRead_gva = Backend-&gt;<span class="built_in">GetArgGva</span>(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(cbPayloadReq &gt; GlobalState.SvgaCmdBodySize) &#123;</span><br><span class="line">    <span class="built_in">DebugPrint</span>(<span class="string">&quot;cbpayloadReq(&#123;:#x&#125;) &gt; SvgaCmdBodySize(&#123;:#x&#125;), restore context and goto next round\n&quot;</span>, cbPayloadReq, GlobalState.SvgaCmdBodySize);</span><br><span class="line">    <span class="keyword">return</span> GlobalState.<span class="built_in">RestoreGprs</span>(Backend);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(cbPayloadReq &gt; u32PbBounceBufMaxSize) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint64_t</span> RetAddr = Backend-&gt;<span class="built_in">VirtRead8</span>(<span class="built_in">Gva_t</span>(Backend-&gt;<span class="built_in">Rsp</span>()));</span><br><span class="line">    <span class="built_in">DebugPrint</span>(<span class="string">&quot;check this, RetAddr = &#123;:#x&#125;\n&quot;</span>, RetAddr);</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!Backend-&gt;<span class="built_in">VirtWriteDirty</span>(pbBounceBuf_gva, GlobalState.SvgaCmdBody, cbPayloadReq)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to write pbBounceBuf, pbBounceBuf = &#123;:#x&#125;, cbPayloadReq = &#123;:#x&#125;, SvgaCmdBodySize = &#123;:#x&#125;\n&quot;</span>,</span><br><span class="line">                pbBounceBuf_gva.<span class="built_in">U64</span>(), cbPayloadReq, GlobalState.SvgaCmdBodySize);</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!Backend-&gt;<span class="built_in">VirtWriteStructDirty</span>(pcbAlreadyRead_gva, &amp;cbPayloadReq)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Faile to write pcbAlreadyRead, pcbAlreadyRead = &#123;:#x&#125;\n&quot;</span>, pcbAlreadyRead_gva.<span class="built_in">U64</span>());</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(pbBounceBuf_gva.<span class="built_in">U64</span>());</span><br><span class="line"></span><br><span class="line">&#125;)) &#123;</span><br><span class="line">  fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to Setbreakpoint on VBoxDD!vmsvgaR3FifoGetCmdPayload\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I also had to define end point of execution. After some reversing, I found two spots and using it as end point.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> Gva_t SvgaLoopEnd = <span class="built_in">Gva_t</span>(g_Dbg.<span class="built_in">GetSymbol</span>(<span class="string">&quot;VBoxDD!vmsvgaR3FifoLoop&quot;</span>) + <span class="number">0x24AB</span>);</span><br><span class="line"><span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">Setbreakpoint</span>(SvgaLoopEnd, [](Backend_t *Backend) &#123;</span><br><span class="line">  <span class="built_in">DebugPrint</span>(<span class="string">&quot;loop end reached, restore context\n&quot;</span>);</span><br><span class="line">  GlobalState.<span class="built_in">RestoreGprs</span>(g_Backend);</span><br><span class="line">&#125;)) &#123;</span><br><span class="line">  fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to Setbreakpoint on SvgaLoopEnd\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> Gva_t SvgLoopEnd2 = <span class="built_in">Gva_t</span>(g_Dbg.<span class="built_in">GetSymbol</span>(<span class="string">&quot;VBoxDD!vmsvgaR3FifoLoop&quot;</span>) + <span class="number">0x24B2</span>);</span><br><span class="line"><span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">Setbreakpoint</span>(SvgLoopEnd2, [](Backend_t *Backend) &#123;</span><br><span class="line">  <span class="built_in">DebugPrint</span>(<span class="string">&quot;loop end2 reached, restore context\n&quot;</span>);</span><br><span class="line">  GlobalState.<span class="built_in">RestoreGprs</span>(g_Backend);</span><br><span class="line">&#125;)) &#123;</span><br><span class="line">  fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to Setbreakpoint on SvgLoopEnd2\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As I said above, I create a snapshot on <code>vmsvgaR3FifoLoop+4E2</code>. So if I restore register context, next execution flow starts from there. Because of that, I had to parse new testcase using breakpoint Handler.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> Gva_t SvgaLoopStart = <span class="built_in">Gva_t</span>(g_Dbg.<span class="built_in">GetSymbol</span>(<span class="string">&quot;VBoxDD!vmsvgaR3FifoLoop&quot;</span>) + <span class="number">0x4e2</span>);</span><br><span class="line"><span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">Setbreakpoint</span>(SvgaLoopStart, [](Backend_t *Backend) &#123;</span><br><span class="line">  <span class="keyword">if</span>(GlobalState.SvgaCmds.<span class="built_in">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">DebugPrint</span>(<span class="string">&quot;testcase deque empty! goto next round...\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Backend-&gt;<span class="built_in">Stop</span>(<span class="built_in">Ok_t</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> &amp;Testcase = GlobalState.SvgaCmds.<span class="built_in">front</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (Testcase.SvgaCmdCode == <span class="number">1045</span>) &#123;</span><br><span class="line">    GlobalState.SvgaCmds.<span class="built_in">pop_front</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(GlobalState.SvgaCmds.<span class="built_in">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">DebugPrint</span>(<span class="string">&quot;testcase deque empty during cmd filtering! goto next round...\n&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> Backend-&gt;<span class="built_in">Stop</span>(<span class="built_in">Ok_t</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Testcase = GlobalState.SvgaCmds.<span class="built_in">front</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Backend-&gt;<span class="built_in">Rbx</span>(Testcase.SvgaCmdCode);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">DebugPrint</span>(<span class="string">&quot;SvgaCmdCode = &#123;:#x&#125;\n&quot;</span>, Testcase.SvgaCmdCode);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(Testcase.SvgaCmdCode &gt;= <span class="number">1040</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">DebugPrint</span>(<span class="string">&quot;Have to avoid AssertBreak(pHdr-&gt;size &lt; pThis-&gt;svga.cbFIFO), write &#123;:#x&#125; on first DWORD\n&quot;</span>, Testcase.SvgaBody.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> Svga3dCmdSize = Testcase.SvgaBody.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span>(Svga3dCmdSize &gt;= <span class="number">0x200000</span>) &#123;</span><br><span class="line">      fmt::<span class="built_in">print</span>(<span class="string">&quot;Svga3dCmdSize(&#123;:#x&#125;) &gt; cbFIFO, abort\n&quot;</span>, Svga3dCmdSize);</span><br><span class="line">      std::<span class="built_in">abort</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;GlobalState.SvgaCmdBody[<span class="number">0</span>], &amp;Svga3dCmdSize, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;GlobalState.SvgaCmdBody[<span class="number">4</span>], Testcase.SvgaBody.<span class="built_in">data</span>(), Testcase.SvgaBody.<span class="built_in">size</span>());</span><br><span class="line">    GlobalState.SvgaCmdBodySize = Testcase.SvgaBody.<span class="built_in">size</span>() + <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(GlobalState.SvgaCmdBody, Testcase.SvgaBody.<span class="built_in">data</span>(), Testcase.SvgaBody.<span class="built_in">size</span>());</span><br><span class="line">    GlobalState.SvgaCmdBodySize = Testcase.SvgaBody.<span class="built_in">size</span>();</span><br><span class="line">  &#125;    </span><br><span class="line"></span><br><span class="line">  GlobalState.SvgaCmds.<span class="built_in">pop_front</span>();</span><br><span class="line">&#125;)) &#123;</span><br><span class="line">  fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to Setbreakpoint on SvgaLoopStart\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After some investigation, I found <code>CreateDeviceEx</code> call in <code>vmsvga3dContextDefine</code> keep causing <strong>CR3 context switching</strong> and I didnâ€™t found any way to handling it using breakpoint handler. So I just blacklisting it( <code>SVGA_3D_CMD_CONTEXT_DEFINE</code> &#x3D; <code>1045</code> ).</p>
<p>I disclose almost every part of fuzz module except mutation part. I just use libfuzzer mutator to mutate body data of SVGA command and pick one of command in array randomly.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">CustomMutator_t</span><span class="params">(std::mt19937_64 &amp;Rng, <span class="type">const</span> <span class="type">size_t</span> TestcaseMaxSize)</span></span></span><br><span class="line"><span class="function">  : Rng_(Rng), TestcaseMaxSize_(TestcaseMaxSize) &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// set maximum size for multiple (mutated) testcase( Default = 1MB )</span></span><br><span class="line">    ScratchBuffer__ = std::<span class="built_in">make_unique</span>&lt;<span class="type">uint8_t</span>[]&gt;(_1MB);</span><br><span class="line">    ScratchBuffer_  = &#123;ScratchBuffer__.<span class="built_in">get</span>(), _1MB&#125;;</span><br><span class="line"></span><br><span class="line">    BodyMutator_ = <span class="built_in">make_unique</span>&lt;LibfuzzerMutator_t&gt;(Rng, TestcaseMaxSize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// skip for brevity...</span></span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">Mutate</span><span class="params">(<span class="type">uint8_t</span> *Data, <span class="type">const</span> <span class="type">size_t</span> DataLen, <span class="type">const</span> <span class="type">size_t</span> MaxSize)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">auto</span> Root = <span class="built_in">Deserialize</span>(Data, DataLen);</span><br><span class="line">  <span class="keyword">auto</span> &amp;SvgaCmds = Root.SvgaCmds;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;SvgaCmd : SvgaCmds) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 50%</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">GetUint32</span>(<span class="number">0</span>, <span class="number">1</span>) == <span class="number">1</span>) &#123;  </span><br><span class="line">      <span class="type">uint32_t</span> SvgaCmdRandomIdx = <span class="built_in">GetUint32</span>(<span class="number">0</span>, SvgaCmdListLen);</span><br><span class="line">      SvgaCmd.SvgaCmdCode = SvgaCmdList[SvgaCmdRandomIdx];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(GlobalMutBuffer, SvgaCmd.SvgaBody.<span class="built_in">data</span>(), SvgaCmd.SvgaBody.<span class="built_in">size</span>());</span><br><span class="line">    <span class="type">size_t</span> NewTestcaseSize = BodyMutator_-&gt;Mut_.<span class="built_in">Mutate</span>(GlobalMutBuffer, SvgaCmd.SvgaBody.<span class="built_in">size</span>(), MaxSize);</span><br><span class="line">    SvgaCmd.SvgaBody.<span class="built_in">resize</span>(NewTestcaseSize);</span><br><span class="line">    <span class="built_in">memcpy</span>(SvgaCmd.SvgaBody.<span class="built_in">data</span>(), GlobalMutBuffer, NewTestcaseSize);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  json::json Serialized;</span><br><span class="line">  <span class="built_in">to_json</span>(Serialized, Root);</span><br><span class="line">  <span class="keyword">return</span> Serialized.<span class="built_in">dump</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I also define generator function. It is very useful if you are too lazy to create random input like me ^~^.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">GenerateTestcase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  SvgaCmds_t Root;</span><br><span class="line">  <span class="type">const</span> <span class="keyword">auto</span> N = <span class="built_in">GetUint32</span>(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> Idx = <span class="number">0</span>; Idx &lt; N; Idx++) &#123;</span><br><span class="line">    SvgaCmd_t SvgaCmd;</span><br><span class="line">    </span><br><span class="line">    SvgaCmd.SvgaCmdCode = SvgaCmdList[<span class="built_in">GetUint32</span>(<span class="number">0</span>, SvgaCmdListLen)];</span><br><span class="line">    SvgaCmd.SvgaBody.<span class="built_in">resize</span>(<span class="built_in">GetUint32</span>(<span class="number">0x100</span>, <span class="number">0x400</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">GetUint32</span>(<span class="number">0</span>, <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; SvgaCmd.SvgaBody.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        SvgaCmd.SvgaBody[i] = <span class="number">0x41</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; SvgaCmd.SvgaBody.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        SvgaCmd.SvgaBody[i] = (<span class="type">uint8_t</span>)<span class="built_in">GetUint32</span>(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Root.SvgaCmds.<span class="built_in">emplace_back</span>(SvgaCmd);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  json::json Serialized;</span><br><span class="line">  <span class="built_in">to_json</span>(Serialized, Root);</span><br><span class="line">  <span class="keyword">return</span> Serialized.<span class="built_in">dump</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">GetNewTestcase</span><span class="params">(<span class="type">const</span> Corpus_t &amp;Corpus)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 20%</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">GetUint32</span>(<span class="number">1</span>, <span class="number">5</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">GenerateTestcase</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> Testcase_t *Testcase = Corpus.<span class="built_in">PickTestcase</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!Testcase) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;The corpus is empty, generate random one\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">GenerateTestcase</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Copy the input in a buffer we&#x27;re going to mutate.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memcpy</span>(ScratchBuffer_.<span class="built_in">data</span>(), Testcase-&gt;Buffer_.<span class="built_in">get</span>(),</span><br><span class="line">         Testcase-&gt;BufferSize_);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// return Mutate(ScratchBuffer_.data(), Testcase-&gt;BufferSize_, TestcaseMaxSize_);</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Mutate</span>(ScratchBuffer_.<span class="built_in">data</span>(), Testcase-&gt;BufferSize_, u32PbBounceBufMaxSize - <span class="built_in">sizeof</span>(<span class="type">uint32_t</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Aaaaannnd, this is everything you need to fuzz! I skip some formal code for brevity, but I think you can easily find what you need to define fully working fuzz module.</p>
<p>â€¦..Ooooh wait, I forgot something. After some hours of struggle, I define a blacklist which cause CR3 context switching. I just put it on the end of <code>Init()</code> function.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">SetupVBoxBlacklistHooks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;VBoxRT!RTLogLoggerEx&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on VBoxRT!RTLogLoggerEx\n&quot;</span>);</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;VBoxVMM!PDMCritSectLeave&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on VBoxVMM!PDMCritSectLeave\n&quot;</span>);</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;VBoxC!util::AutoLockBase::release&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on VBoxC!util::AutoLockBase::release\n&quot;</span>);</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;VBoxC!util::AutoLockBase::acquire&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on VBoxC!util::AutoLockBase::acquire\n&quot;</span>);</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;VirtualBoxVM!UIFrameBufferPrivate::NotifyChange&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on VirtualBoxVM!UIFrameBufferPrivate::NotifyChange\n&quot;</span>);</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;VBoxRT!SUPSemEventWaitNoResume&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on VBoxRT!SUPSemEventWaitNoResume\n&quot;</span>);</span><br><span class="line">    std::<span class="built_in">abort</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;d3d9!CBaseDevice::Release&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on d3d9!CBaseDevice::Release\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;d3d9!CD3DBase::Clear&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on d3d9!CD3DBase::Clear\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;d3d9!CMipMap::SetAutoGenFilterType&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on d3d9!CMipMap::SetAutoGenFilterType\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;d3d9!CMipMap::GenerateMipSubLevels&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on d3d9!CMipMap::GenerateMipSubLevels\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!g_Backend-&gt;<span class="built_in">SetBreakpoint</span>(<span class="string">&quot;USER32!GetDC&quot;</span>, [](Backend_t *Backend) &#123;</span><br><span class="line">    Backend-&gt;<span class="built_in">SimulateReturnFromFunction</span>(<span class="number">0x1337</span>);</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Failed to SetBreakpoint on USER32!GetDC\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Yep. Thatâ€™s really everything. I use this fuzz module several hours and it founds interesting crash.</p>
<h1 id="3-Vulnerability-TL-DR"><a href="#3-Vulnerability-TL-DR" class="headerlink" title="3. Vulnerability( TL;DR )"></a>3. Vulnerability( TL;DR )</h1><p>Crash occurred in <code>vmsvga3dSurfaceCopy</code> function( <strong>PageHeap</strong> needed ).</p>
<p><img src="https://github.com/henices/pictures/raw/master/wtf-vbox-blahblah2.png" alt="blahblah2"></p>
<p>This function trying to copy surface data from one to another using surface id and thereâ€™s no boundary check between surface, so it become exploitable wildcopy vulnerability in heap memory.</p>
<p><img src="https://github.com/henices/pictures/raw/master/wtf-vbox-blahblah3.png" alt="spot the bug"></p>
<p>This vulnerability patched in <a target="_blank" rel="noopener" href="https://www.oracle.com/security-alerts/cpujul2022.html">6.1.36 release</a> at July, 2022.</p>
<h1 id="4-Conclusion"><a href="#4-Conclusion" class="headerlink" title="4. Conclusion"></a>4. Conclusion</h1><p>I think importance of snapshot fuzzing is, it makes researcher to focus on target itself. </p>
<p>Unlike other fuzzers based on runtime and DBI are often create (very) unreasonable side effect or need lots of time to create working harness. The concept of snapshot fuzzing makes it possible to reduce this waste of time.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/06/30/stock_emotion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/30/stock_emotion/" class="post-title-link" itemprop="url">å¸‚åœºæƒ…ç»ªæŒ‡æ ‡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-30 09:59:36" itemprop="dateCreated datePublished" datetime="2022-06-30T09:59:36+08:00">2022-06-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å¯ä»¥é‡åŒ–ä¸€ä¸‹ï¼Œæœ‰æ—¶é—´è€ƒè™‘ç¨‹åºå®ç°ã€‚</p>
<ul>
<li>æ¶¨&#x2F;è·Œåœæ¿æ•°</li>
<li>æ¶¨åœå°ç‰ˆæˆåŠŸç‡</li>
<li>æ¶¨è·Œè‚¡ç¥¨æ¯”ç‡</li>
<li>å¤§ç›˜æˆäº¤é‡é¢</li>
<li>èèµ„ä½™é¢æƒ…å†µ</li>
<li>åŒ—å‘èµ„é‡‘å‡€æµå…¥ ï¼ˆå‚è€ƒï¼‰</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/06/17/Automatic_Investment_Plan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/17/Automatic_Investment_Plan/" class="post-title-link" itemprop="url">å…³äºå®šæŠ•çš„ä¸€äº›æ€è€ƒ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-17 13:02:06" itemprop="dateCreated datePublished" datetime="2022-06-17T13:02:06+08:00">2022-06-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>å®šæŠ•åªæœ‰åœ¨ä½ä¼°çš„æ—¶å€™ä¹°ï¼Œå½“ä¼°å€¼è¿›å…¥ä¸­ä½æ•°ä»¥ä¸Šå°±ä¸è¦ä¹°äº†ï¼ŒåŒæ—¶å®šæŠ•æ ‡çš„çš„ä¼°å€¼åº”è¯¥åœ¨å†å²åº•éƒ¨åŒºåŸŸã€‚</li>
<li>å®šæŠ•çš„æœ¬è´¨ä¸æ˜¯ä»·å€¼æŠ•èµ„ï¼Œè€Œæ˜¯ç›¸ä¿¡ä¼°å€¼å›å½’ä¸­ä½æ•°ã€‚ </li>
<li>æŒ‡æ•°åŸºé‡‘ï¼Œå‘¨æœŸæ€§è¡Œä¸šé€‚åˆå®šæŠ•ï¼Œæ¯”å¦‚åˆ¸å•†ï¼Œé’¢é“ï¼Œç…¤ç‚­ã€‚ä¸€èˆ¬æŒ‰æ—¶é—´å®šæŠ•ï¼Œå¦‚æœå¤§å¹…ä¸‹è·Œä¹Ÿè¦ä¹°ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´å®šæŠ•å±äºç­–ç•¥å‹çš„æŠ•èµ„æ–¹æ³•ï¼Œå…¶å®å¹¶ä¸çŸ¥é“åº•å’Œé¡¶åœ¨å“ªé‡Œï¼Œé€šè¿‡æ‹‰é•¿æ—¶é—´æ¥é™ä½æŒä»“æˆæœ¬ï¼Œå› æ­¤å®šæŠ•æˆåŠŸçš„å…³é”®åœ¨äºä½ çš„æˆæœ¬æ˜¯å¦å¯ä»¥éšç€æ—¶é—´è€Œé™ä¸‹æ¥ã€‚ä»è¿™ç‚¹ä¹Ÿå¯ä»¥åˆ†æå‡ºåœ¨åº•éƒ¨åŒºåŸŸå®šæŠ•æ¯”åœ¨é¡¶éƒ¨åŒºåŸŸå®šæŠ•è¦å¥½å¾—å¤šï¼Œè¿™ä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¡ã€‚</p>
<p>å®šæŠ•ç­–ç•¥å¯¹å†å²çš„ä¼°å€¼æƒ…å†µæœ‰å¾ˆå¼ºçš„ä¾èµ–ï¼Œå±äºåŸºäºå†å²æ•°æ®çš„ç»Ÿè®¡åˆ†æï¼Œä½†æ˜¯æ¯ä¸€æ¬¡çš„æƒ…å†µéƒ½ä¸åŒï¼Œæ²¡æœ‰äººå¯ä»¥ä¿è¯å†å²ä¸€å®šä¼šé‡æ¼”ã€‚å®šæŠ•ä¹Ÿä¸æ˜¯ä»·å€¼æŠ•èµ„ï¼Œæ²¡æœ‰æŠ¤åŸæ²³ï¼Œåªæ˜¯ç›¸ä¿¡å‡å€¼å›å½’ï¼Œè¿™æ˜¯ç¬¬äºŒæ¡ã€‚</p>
<p>å·´è²ç‰¹éå¸¸æ¨èæ ‡æ™®500æŒ‡æ•° (S&amp;P 500) å®šæŠ•ï¼ŒæŒ‡æ•°åŸºé‡‘æœ€ç‰›çš„åœ°æ–¹æ˜¯è‚¡ç¥¨ä¼šå®šæœŸè°ƒæ•´ï¼ŒæŠŠå¥½çš„è‚¡ç¥¨åŠ å…¥è¿›æ¥ï¼Œå·®çš„æ·˜æ±°å‡ºå»ï¼Œç›¸å½“äºæœ‰äººå¸®ä½ é€‰è‚¡äº†ï¼Œå¦å¤–è¶³å¤Ÿåˆ†æ•£ï¼Œå‘ç”Ÿç³»ç»Ÿæ€§é£é™©çš„æ¦‚ç‡å¤§å¹…é™ä½ã€‚å‘¨æœŸæ€§è¡Œä¸šåˆ™æ˜¯çˆ†å‘æ€§å¾ˆå¼ºï¼Œä¸‰å¹´ä¸å¼€å¼ ï¼Œå¼€å¼ åƒä¸‰å¹´ï¼Œå®¹æ˜“åœ¨åº•éƒ¨ç§¯ç´¯å¤§é‡ç­¹ç ï¼Œä½œä¸ºä¸€ä¸ªé•¿æœŸæŠ•èµ„ç­–ç•¥éå¸¸åˆé€‚ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/05/16/Fedora36-Nvidia/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/16/Fedora36-Nvidia/" class="post-title-link" itemprop="url">å‡çº§ Fedora 36ï¼Œé‡ä¸Š Nvidia é©±åŠ¨é—®é¢˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-16 16:58:37" itemprop="dateCreated datePublished" datetime="2022-05-16T16:58:37+08:00">2022-05-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Fedora 36 æ­£å¼ç‰ˆå·²ç»é‡Šå‡ºä¸€æ®µæ—¶é—´äº†ï¼Œæ ¹æ®æˆ‘çš„ç»éªŒå¼€å§‹çš„ä¸€å‘¨éƒ½ä¼šæœ‰ bugï¼Œä¸€èˆ¬ç­‰ä¸€æ®µæ—¶é—´å†å‡çº§ä¼šæ›´å¹³æ»‘ä¸€äº›ã€‚ç„¶è€Œï¼Œè€é©å‘½åˆé‡ä¸Šäº†æ–°é—®é¢˜ï¼Œæ˜¾ç¤ºå‡ºé—®é¢˜äº†å¯åŠ¨ä¸èµ·æ¥ã€‚æˆ‘å·²ç»å¾ˆä¹…æ²¡æœ‰é‡ä¸Šæ˜¾ç¤ºé©±åŠ¨é—®é¢˜äº†ï¼Œæˆ‘åœ¨å¾ˆä¹…ä»¥å‰å°±ç¦ç”¨äº†å¼€æºé©±åŠ¨ <code>nouveau</code>ï¼Œä¸€ç›´éƒ½ç”¨å¾—å¾ˆå¥½ã€‚</p>
<p>ä¿®æ”¹ &#x2F;etc&#x2F;default&#x2F;grub æ–‡ä»¶ï¼Œåœ¨ <code>GRUB_CMDLINE_LINUX</code> æ·»åŠ ä¸‹é¢å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX=&quot;... rd.driver.blacklist=nouveau modprobe.blacklist=nouveau nvidia-drm.modeset=1&quot;</span><br></pre></td></tr></table></figure>

<p>é‡æ–°ç”Ÿæˆ grub æ–‡ä»¶ï¼Œ <code>sudo grub2-mkconfig -o /boot/grub2/grub.cfg</code>ï¼Œä½†æ˜¯åœ¨å‡çº§ Fedora 36 åä¼¼ä¹æ²¡æœ‰èµ·ä½œç”¨ã€‚è¯¡å¼‚çš„æ˜¯ Fedora 35 çš„å†…æ ¸å´å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œé¦–å…ˆæ€€ç–‘çš„æ˜¯ nvidia é©±åŠ¨å¯èƒ½æ²¡æœ‰å®‰è£…å¯¹ã€‚æ‰§è¡Œä¸‹é¢å‘½ä»¤è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf reinstall xorg-x11-drv-nvidia akmod-nvidia kmod-nvidia.x86_64</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>

<p>å¯æƒœæ²¡æœ‰è§£å†³é—®é¢˜ï¼Œä¸Šç½‘æ‰¾èµ„æ–™çœ‹çœ‹ Fedora 36 æœ‰æ²¡ä»€ä¹ˆç‰¹æ®Šçš„åœ°æ–¹ã€‚å®‰è£… Nvidia é©±åŠ¨ç½‘ä¸Šæœ‰è¿™ç¯‡æ–‡ç« è¯´çš„è¯¦ç»†<br><a target="_blank" rel="noopener" href="https://www.linuxcapable.com/how-to-install-nvidia-drivers-on-fedora-36-linux/">https://www.linuxcapable.com/how-to-install-nvidia-drivers-on-fedora-36-linux/</a><br>ä»”ç»†æ‹œè¯»äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯æ²¡æœ‰å‘ç°å•¥é—®é¢˜ï¼Œé©±åŠ¨ä¹Ÿé‡æ–°å®‰è£…äº†å•Šï¼Œå¼€å§‹æ€€ç–‘æ˜¯æ–°ç‰ˆ Nvidia é©±åŠ¨çš„é—®é¢˜</p>
<p><code>sudo dnf search xorg-x11-drv-nvidia</code> å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„é©±åŠ¨ï¼Œ<code>xorg-x11-drv-nvidia-340xx</code> <code>xorg-x11-drv-nvidia-340xx</code> <code>xorg-x11-drv-nvidia-340xx</code> ä¸çŸ¥é“åˆ°åº•éœ€è¦å®‰è£…å“ªä¸ªç‰ˆæœ¬çš„é©±åŠ¨ã€‚ğŸ˜­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">xorg-x11-drv-nvidia.x86_64 : NVIDIA&#x27;s proprietary display driver for NVIDIA graphic cards</span><br><span class="line">=========================================================================== åç§° å’Œ æ¦‚å†µ åŒ¹é…ï¼šxorg-x11-drv-nvidia</span><br><span class="line">xorg-x11-drv-nvidia-340xx-cuda.x86_64 : CUDA libraries for xorg-x11-drv-nvidia-340xx</span><br><span class="line">xorg-x11-drv-nvidia-340xx-devel.i686 : Development files for xorg-x11-drv-nvidia-340xx</span><br><span class="line">xorg-x11-drv-nvidia-340xx-devel.x86_64 : Development files for xorg-x11-drv-nvidia-340xx</span><br><span class="line">xorg-x11-drv-nvidia-340xx-kmodsrc.x86_64 : xorg-x11-drv-nvidia-340xx kernel module source code</span><br><span class="line">xorg-x11-drv-nvidia-340xx-libs.i686 : Libraries for xorg-x11-drv-nvidia-340xx</span><br><span class="line">xorg-x11-drv-nvidia-340xx-libs.x86_64 : Libraries for xorg-x11-drv-nvidia-340xx</span><br><span class="line">xorg-x11-drv-nvidia-390xx-cuda.x86_64 : CUDA driver for xorg-x11-drv-nvidia-390xx</span><br><span class="line">xorg-x11-drv-nvidia-390xx-cuda-libs.i686 : CUDA libraries for xorg-x11-drv-nvidia-390xx</span><br><span class="line">xorg-x11-drv-nvidia-390xx-cuda-libs.x86_64 : CUDA libraries for xorg-x11-drv-nvidia-390xx</span><br><span class="line">xorg-x11-drv-nvidia-390xx-devel.i686 : Development files for xorg-x11-drv-nvidia-390xx</span><br><span class="line">xorg-x11-drv-nvidia-390xx-devel.x86_64 : Development files for xorg-x11-drv-nvidia-390xx</span><br><span class="line">xorg-x11-drv-nvidia-390xx-kmodsrc.x86_64 : xorg-x11-drv-nvidia-390xx kernel module source code</span><br><span class="line">xorg-x11-drv-nvidia-390xx-libs.i686 : Libraries for xorg-x11-drv-nvidia-390xx</span><br><span class="line">xorg-x11-drv-nvidia-390xx-libs.x86_64 : Libraries for xorg-x11-drv-nvidia-390xx</span><br><span class="line">xorg-x11-drv-nvidia-470xx-cuda.x86_64 : CUDA driver for xorg-x11-drv-nvidia-470xx</span><br><span class="line">xorg-x11-drv-nvidia-470xx-cuda-libs.i686 : CUDA libraries for xorg-x11-drv-nvidia-470xx</span><br><span class="line">xorg-x11-drv-nvidia-470xx-cuda-libs.x86_64 : CUDA libraries for xorg-x11-drv-nvidia-470xx</span><br><span class="line">xorg-x11-drv-nvidia-470xx-devel.i686 : Development files for xorg-x11-drv-nvidia-470xx</span><br><span class="line">xorg-x11-drv-nvidia-470xx-devel.x86_64 : Development files for xorg-x11-drv-nvidia-470xx</span><br><span class="line">xorg-x11-drv-nvidia-470xx-kmodsrc.x86_64 : xorg-x11-drv-nvidia-470xx kernel module source code</span><br><span class="line">xorg-x11-drv-nvidia-470xx-libs.i686 : Libraries for xorg-x11-drv-nvidia-470xx</span><br><span class="line">xorg-x11-drv-nvidia-470xx-libs.x86_64 : Libraries for xorg-x11-drv-nvidia-470xx</span><br></pre></td></tr></table></figure>

<p>å¯æ˜¯ä»”ç»†ä¸€ç¢ç£¨ï¼Œ Fedora 35 Nvidia é©±åŠ¨ä¸æ˜¯å·¥ä½œæ­£å¸¸å—ï¼Œå¯ä»¥ä¸Šå»çœ‹çœ‹ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„é©±åŠ¨ï¼Œæ‰§è¡Œå‘½ä»¤ <code>nvidia-settings</code>,åœ¨ System Information ä¸­å‘ç°ä½¿ç”¨çš„å°±æ˜¯æœ€æ–°ç‰ˆæœ¬çš„é©±åŠ¨ <strong>510.68.02</strong>ï¼Œçœ‹æ ·å­æœ€æ–°ç‰ˆæœ¬çš„é©±åŠ¨ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œä¸€ä¸‹é™·å…¥äº†å›°å¢ƒã€‚ğŸ˜°</p>
<p>æ²¡å•¥å¥½åŠæ³•ï¼Œè¿˜æ˜¯ Google æœç´¢ä¸€ä¸‹ï¼Œç»“æœå‘ç°äº†ä¸€ä¸ªé“¾æ¥åœ¨è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œå’Œæˆ‘é‡ä¸Šçš„ç°è±¡ä¸€æ ·ï¼Œä½œè€…æœ€ç»ˆè§£å†³äº†é—®é¢˜<br><a target="_blank" rel="noopener" href="https://ask.fedoraproject.org/t/fedora-linux-kernel-update-breaks-nvidia-driver/21954/11">Fedora Linux kernel update breaks NVIDIA driver</a></p>
<p>åŸæ¥æ˜¯æ—§ç‰ˆçš„é©±åŠ¨æ²¡æœ‰å¸è½½å¹²å‡€ï¼Œå‚è€ƒ <a target="_blank" rel="noopener" href="https://rpmfusion.org/Howto/NVIDIA#Uninstall_the_NVIDIA_driver">https://rpmfusion.org/Howto/NVIDIA#Uninstall_the_NVIDIA_driver</a><br>é©±åŠ¨å¸è½½ Nvidia é©±åŠ¨éœ€è¦ä½¿ç”¨å‘½ä»¤ <code>dnf remove xorg-x11-drv-nvidia\*</code></p>
<p>æŒ‰ç…§ä¸‹é¢çš„å‘½ä»¤æ“ä½œäº†ä¸€éï¼Œé‡å¯ç³»ç»Ÿï¼Œç†Ÿæ‚‰çš„ç™»å½•ç•Œé¢ç»ˆäºåˆå‡ºç°äº†ã€‚ğŸ˜„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf remove xorg-x11-drv-nouveau</span><br><span class="line">sudo dnf remove xorg-x11-drv-nvidia\*</span><br><span class="line">sudo dnf install xorg-x11-drv-nvidia akmod-nvidia kmod-nvidia.x86_64</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/05/11/libprotobuf-mutator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/11/libprotobuf-mutator/" class="post-title-link" itemprop="url">libprotobuf-mutator ç®€å•åˆ†æ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-11 15:26:12" itemprop="dateCreated datePublished" datetime="2022-05-11T15:26:12+08:00">2022-05-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="What-are-protocol-buffers"><a href="#What-are-protocol-buffers" class="headerlink" title="What are protocol buffers?"></a><a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/docs/overview">What are protocol buffers?</a></h2><p>Protocol buffers are Googleâ€™s language-neutral, platform-neutral, extensible mechanism for serializing structured data â€“ think XML, but smaller, faster, and simpler. You define how you want your data to be structured once, then you can use special generated source code to easily write and read your structured data to and from a variety of data streams and using a variety of languages.</p>
<p>è¿™æ®µæ˜¯ Google å®˜æ–¹ç½‘ç«™ç»™å‡ºçš„ä»‹ç»ï¼Œprotobuf å¯ä»¥è‡ªåŠ¨åŒ–ç”Ÿæˆä»£ç ï¼Œç”¨äºè¯»å…¥æˆ–è€…å†™å…¥ç»“æ„åŒ–æ•°æ®ã€‚ä¸€ä¸ªç®€å•çš„ protobuf æ–‡ä»¶å¯ä»¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">required</span> <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">required</span> <span class="type">int32</span> id = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="type">string</span> email = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…·ä½“çš„è¯­æ³•å¯ä»¥å‚è€ƒGoogle çš„æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/docs/proto">proto2</a> å’Œ <a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/docs/proto3">proto3</a>ã€‚c++ è¯­è¨€ä½¿ç”¨ protobuf çš„ç¤ºä¾‹å¯ä»¥å‚è§<a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/docs/cpptutorial">Protocol Buffer Basics: C++</a> æ–‡æ¡£ï¼ŒåŸºæœ¬æ­¥éª¤æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li>å†™ protobuf æ–‡ä»¶ï¼Œè¡¨è¾¾æ•°æ®ç»“æ„</li>
<li>åˆ©ç”¨ protoc è‡ªåŠ¨ç”Ÿæˆä»£ç  ï¼ˆæ”¯æŒå¤šç§è¯­è¨€ C++ Java ç­‰ï¼‰</li>
<li>åˆ©ç”¨ç”Ÿæˆçš„æ–‡ä»¶è§£ææˆ–è€…å†™å…¥ç›¸å…³æ•°æ®ç»“æ„</li>
</ol>
<h2 id="libprotobuf-mutator"><a href="#libprotobuf-mutator" class="headerlink" title="libprotobuf-mutator"></a>libprotobuf-mutator</h2><h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h3><p>å‚è€ƒï¼š <a target="_blank" rel="noopener" href="https://github.com/google/libprotobuf-mutator/blob/master/README.md">https://github.com/google/libprotobuf-mutator/blob/master/README.md</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/google/libprotobuf-mutator.git</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -GNinja -DCMAKE_C_COMPILER=clang -DLIB_PROTO_MUTATOR_DOWNLOAD_PROTOBUF=ON -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_BUILD_TYPE=Debug</span><br><span class="line">https_proxy=http://127.0.0.1:3128 ninja check</span><br></pre></td></tr></table></figure>

<p>ç”±äºéœ€è¦ä»Googleä¸‹è½½ä¸€äº›æºç ï¼Œæ‰€ä»¥åœ¨ <code>ninja check</code> çš„æ—¶å€™éœ€è¦æŒ‚ä¸Šä»£ç†ï¼Œç»“æœç¼–è¯‘å‡ºé”™äº†ï¼Œæ‰¾ä¸åˆ° <code>libxml2.a</code>ï¼Œæ’æŸ¥ä¸€ä¸‹ç¼–è¯‘å‚æ•°ï¼Œå‘ç°éœ€è¦æ·»åŠ ç¼–è¯‘é™æ€åº“çš„å‚æ•°</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/cmake/external/libxml2.cmake b/cmake/external/libxml2.cmake</span></span><br><span class="line"><span class="comment">index c00ace2..a944fab 100644</span></span><br><span class="line"><span class="comment">--- a/cmake/external/libxml2.cmake</span></span><br><span class="line"><span class="comment">+++ b/cmake/external/libxml2.cmake</span></span><br><span class="line"><span class="meta">@@ -38,6 +38,7 @@</span> ExternalProject_Add($&#123;LIBXML2_TARGET&#125;</span><br><span class="line">     UPDATE_COMMAND &quot;&quot;</span><br><span class="line">     CONFIGURE_COMMAND $&#123;LIBXML2_SRC_DIR&#125;/autogen.sh --without-python</span><br><span class="line">                                                     --prefix=$&#123;LIBXML2_INSTALL_DIR&#125;</span><br><span class="line"><span class="addition">+                                                    --enable-static=yes</span></span><br><span class="line">                                                     CC=$&#123;CMAKE_C_COMPILER&#125;</span><br><span class="line">                                                     CXX=$&#123;CMAKE_CXX_COMPILER&#125;</span><br><span class="line">                                                     CFLAGS=$&#123;LIBXML2_CFLAGS&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åå¯ä»¥æ­£å¸¸é€šè¿‡ <code>ninja check</code> å‘½ä»¤çš„æ‰€æœ‰æ£€æŸ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ <code>ninja install</code> ä¼šå®‰è£…åˆ° &#x2F;usr&#x2F;local ç›®å½•ï¼Œå› ä¸ºè€ƒè™‘åˆ°åç»­éœ€è¦ç»™ <code>afl+</code>ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸‹çš„å‘½ä»¤é‡æ–° cmake ä¸€ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake .. -GNinja -DCMAKE_C_COMPILER=clang -DLIB_PROTO_MUTATOR_DOWNLOAD_PROTOBUF=ON \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=/home/henices/code/AFL+/external/libprotobuf-mutator -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_BUILD_TYPE=Debug</span><br></pre></td></tr></table></figure>
<h3 id="libprotobuf-mutator-ä»£ç å®ç°"><a href="#libprotobuf-mutator-ä»£ç å®ç°" class="headerlink" title="libprotobuf-mutator ä»£ç å®ç°"></a>libprotobuf-mutator ä»£ç å®ç°</h3><p>libfuzzer_macro.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_TEST_ONE_PROTO_INPUT_IMPL(use_binary, Proto)                 \</span></span><br><span class="line"><span class="meta">  extern <span class="string">&quot;C&quot;</span> int LLVMFuzzerTestOneInput(const uint8_t* data, size_t size) &#123; \</span></span><br><span class="line"><span class="meta">    using protobuf_mutator::libfuzzer::LoadProtoInput;                      \</span></span><br><span class="line"><span class="meta">    Proto input;                                                            \</span></span><br><span class="line"><span class="meta">    <span class="keyword">if</span> (LoadProtoInput(use_binary, data, size, &amp;input))                     \</span></span><br><span class="line"><span class="meta">      TestOneProtoInput(input);                                             \</span></span><br><span class="line"><span class="meta">    return 0;                                                               \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Defines custom mutator, crossover and test functions using default</span></span><br><span class="line"><span class="comment">// serialization format. Default is text.</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_PROTO_FUZZER(arg) DEFINE_TEXT_PROTO_FUZZER(arg)</span></span><br><span class="line"><span class="comment">// Defines custom mutator, crossover and test functions using text</span></span><br><span class="line"><span class="comment">// serialization. This format is more convenient to read.</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_TEXT_PROTO_FUZZER(arg) DEFINE_PROTO_FUZZER_IMPL(false, arg)</span></span><br><span class="line"><span class="comment">// Defines custom mutator, crossover and test functions using binary</span></span><br><span class="line"><span class="comment">// serialization. This makes mutations faster. However often test function is</span></span><br><span class="line"><span class="comment">// significantly slower than mutator, so fuzzing rate may stay unchanged.</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_BINARY_PROTO_FUZZER(arg) DEFINE_PROTO_FUZZER_IMPL(true, arg)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_PROTO_FUZZER_IMPL(use_binary, arg)                              \</span></span><br><span class="line"><span class="meta">  static void TestOneProtoInput(arg);                                          \</span></span><br><span class="line"><span class="meta">  using FuzzerProtoType = std::remove_const&lt;std::remove_reference&lt;             \</span></span><br><span class="line"><span class="meta">      std::function<span class="string">&lt;decltype(TestOneProtoInput)&gt;</span>::argument_type&gt;::type&gt;::type; \</span></span><br><span class="line"><span class="meta">  DEFINE_CUSTOM_PROTO_MUTATOR_IMPL(use_binary, FuzzerProtoType)                \</span></span><br><span class="line"><span class="meta">  DEFINE_CUSTOM_PROTO_CROSSOVER_IMPL(use_binary, FuzzerProtoType)              \</span></span><br><span class="line"><span class="meta">  DEFINE_TEST_ONE_PROTO_INPUT_IMPL(use_binary, FuzzerProtoType)                \</span></span><br><span class="line"><span class="meta">  DEFINE_POST_PROCESS_PROTO_MUTATION_IMPL(FuzzerProtoType)                     \</span></span><br><span class="line"><span class="meta">  static void TestOneProtoInput(arg)</span></span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨è·¯å¾„ä¸º <code>DEFINE_PROTO_FUZZER</code> -&gt; <code>DEFINE_TEXT_PROTO_FUZZER</code> -&gt; <code>DEFINE_PROTO_FUZZER_IMPL</code> -&gt; <code>DEFINE_TEST_ONE_PROTO_INPUT_IMPL</code> -&gt; <code>LLVMFuzzerTestOneInput</code> -&gt; <code>TestOneProtoInput</code>ã€‚<br>æœ€ç»ˆè¿˜æ˜¯å®ç°äº†<code>LLVMFuzzerTestOneInput</code> libfuzzer çš„å…¥å£æ–¹æ³•ï¼Œä½¿ç”¨ macro å¯ä»¥å°‘å†™ä¸å°‘ä»£ç éå¸¸æ–¹ä¾¿ï¼Œä»è¿™é‡Œå°±å¯ä»¥çœ‹å‡º fuzz çš„ target function å¿…é¡»å’Œ <code>LLVMFuzzerTestOneInput</code> çš„å‚æ•°ç±»å‹ä¸€è‡´</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fuzz_target.cc</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="type">int</span> <span class="title function_">LLVMFuzzerTestOneInput</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *Data, <span class="type">size_t</span> Size)</span> &#123;</span><br><span class="line">  DoSomethingInterestingWithMyAPI(Data, Size);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;  <span class="comment">// Non-zero return values are reserved for future use.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>libfuzzer_macro.cc</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">LoadProtoInput</span><span class="params">(<span class="type">bool</span> binary, <span class="type">const</span> <span class="type">uint8_t</span>* data, <span class="type">size_t</span> size,</span></span></span><br><span class="line"><span class="params"><span class="function">                    protobuf::Message* input)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">GetCache</span>()-&gt;<span class="built_in">LoadIfSame</span>(data, size, input)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">auto</span> result = binary ? <span class="built_in">ParseBinaryMessage</span>(data, size, input)</span><br><span class="line">                       : <span class="built_in">ParseTextMessage</span>(data, size, input);</span><br><span class="line">  <span class="keyword">if</span> (!result) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="built_in">GetMutator</span>()-&gt;<span class="built_in">Seed</span>(size);</span><br><span class="line">  <span class="built_in">GetMutator</span>()-&gt;<span class="built_in">Fix</span>(input);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LoadProtoInput</code> è¿”å› <code>true</code> æˆ–è€… <code>false</code>ï¼Œå¦‚æœè§£ææˆåŠŸï¼Œå°†è°ƒç”¨ <code>TestOneProtoInput</code>ï¼Œ<code>DEFINE_PROTO_FUZZER</code> macro å…¶å®å°±æ˜¯å†™ TestOneProtoInput çš„å®ç°ã€‚</p>
<h2 id="libprotobuf-mutator-fuzzing-learning"><a href="#libprotobuf-mutator-fuzzing-learning" class="headerlink" title="libprotobuf-mutator_fuzzing_learning"></a>libprotobuf-mutator_fuzzing_learning</h2><p>è¿™æ˜¯ github ä¸Šä¸€ä½åŒè¡Œå†™çš„å­¦ä¹  libprotobuf-mutator fuzzing çš„æ–‡ç« ï¼Œæ€»ä½“å†™çš„ä¸é”™ï¼Œä½†æ˜¯å…¶ä¸­æœ‰ä¸€äº›é”™è¯¯çš„åœ°æ–¹ï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­éƒ½è®°å½•äº†å…¶ä¸­çš„ä¿®æ”¹ã€‚</p>
<h3 id="Simple-protobuf-example"><a href="#Simple-protobuf-example" class="headerlink" title="Simple protobuf example"></a>Simple protobuf example</h3><p>æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning/tree/master/1_simple_protobuf">https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning/tree/master/1_simple_protobuf</a></p>
<p>å…ˆå†™ä¸€ä¸ªç®€å•çš„ protobuf æ–‡ä»¶ï¼Œtest.proto</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto2&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">TEST</span> &#123;</span><br><span class="line">  <span class="keyword">required</span> <span class="type">uint32</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">required</span> <span class="type">string</span> b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>protoc</code> ç¼–è¯‘ protobuf æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> genfiles  </span><br><span class="line">protoc ./test.proto --cpp_out=./genfiles</span><br></pre></td></tr></table></figure>

<p>å°†è‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> ./genfiles</span><br><span class="line">test.pb.cc  test.pb.h</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ªæµ‹è¯•ç¨‹åº test_proto.cc</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;test.pb.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TEST t;</span><br><span class="line">    t.<span class="built_in">set_a</span>(<span class="number">101</span>);</span><br><span class="line">    t.<span class="built_in">set_b</span>(<span class="string">&quot;testtest&quot;</span>);</span><br><span class="line">    cout &lt;&lt; t.<span class="built_in">a</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; t.<span class="built_in">b</span>() &lt;&lt; endl;   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>å†™ Makefile æ¥ç¼–è¯‘ <code>test_proto.cc</code></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CXX=clang++</span><br><span class="line">PB_SRC=test.pb.cc</span><br><span class="line"></span><br><span class="line">PROTOBUF_DIR=<span class="variable">$(HOME)</span>/code/libprotobuf-mutator/build/external.protobuf/</span><br><span class="line">PROTOBUF_LIB=<span class="variable">$(PROTOBUF_DIR)</span>/lib/libprotobufd.a</span><br><span class="line">INC=-I<span class="variable">$(PROTOBUF_DIR)</span>/<span class="keyword">include</span></span><br><span class="line"></span><br><span class="line"><span class="section">test_proto: test_proto.cc <span class="variable">$(PB_SRC)</span></span></span><br><span class="line">	<span class="variable">$(CXX)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> <span class="variable">$(PROTOBUF_LIB)</span> <span class="variable">$(INC)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean: </span></span><br><span class="line">	rm test_proto</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ <code>make</code> åæŠ¥é”™ .&#x2F;test.pb.h:17:2: error: This file was generated by an older version of protoc which isï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨äº† <code>-DLIB_PROTO_MUTATOR_DOWNLOAD_PROTOBUF=ON</code> ä¸‹è½½äº†æ–°ç‰ˆæœ¬çš„ protobufï¼Œæ‰€ä»¥å‡ºäº†è¿™ä¸ªé”™è¯¯ã€‚åªå¥½ä½¿ç”¨ä¸‹è½½çš„ protoc é‡æ–°ç”Ÿæˆ <code>test.pb.cc</code> å’Œ <code>test.pb.h</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/code/libprotobuf-mutator/build/external.protobuf/bin/protoc ./test.proto --cpp_out=./genfiles</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡å¯ä»¥æˆåŠŸ make äº†ï¼Œå®é™…æ‰§è¡Œçš„å‘½ä»¤æ˜¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clang++ -o test_proto test_proto.cc test.pb.cc /home/henices/code/libprotobuf-mutator/build/external.protobuf//lib/libprotobufd.a \</span><br><span class="line"> -I/home/henices/code/libprotobuf-mutator/build/external.protobuf//include</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ <code>./test_proto</code>, è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">101</span><br><span class="line">testtest</span><br></pre></td></tr></table></figure>

<h3 id="Combine-libprotobuf-mutator-with-libfuzzer"><a href="#Combine-libprotobuf-mutator-with-libfuzzer" class="headerlink" title="Combine libprotobuf-mutator with libfuzzer"></a>Combine libprotobuf-mutator with libfuzzer</h3><p>ä»£ç åœ¨ï¼š <a target="_blank" rel="noopener" href="https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning/tree/master/2_libprotobuf_libfuzzer">https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning/tree/master/2_libprotobuf_libfuzzer</a></p>
<p>harness.cc</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">int</span> <span class="title">FuzzTEST</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *data, <span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(data[<span class="number">0</span>] == <span class="string">&#x27;\x01&#x27;</span>) &#123;</span><br><span class="line">        __builtin_trap();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ FuzzTEST æ˜¯æˆ‘ä»¬éœ€è¦æµ‹è¯•çš„ç›®æ ‡å‡½æ•°ã€‚</p>
<p>lpm_libfuzz.cc</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;libprotobuf-mutator/src/libfuzzer/libfuzzer_macro.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;test.pb.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">ProtoToData</span><span class="params">(<span class="type">const</span> TEST &amp;test_proto)</span> </span>&#123;</span><br><span class="line">    std::stringstream all;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> &amp;aa = test_proto.<span class="built_in">a</span>();</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> &amp;bb = test_proto.<span class="built_in">b</span>();</span><br><span class="line">    all.<span class="built_in">write</span>((<span class="type">const</span> <span class="type">char</span>*)&amp;aa, <span class="built_in">sizeof</span>(aa));</span><br><span class="line">    <span class="keyword">if</span>(bb.<span class="built_in">size</span>() != <span class="number">0</span>) &#123;</span><br><span class="line">        all.<span class="built_in">write</span>(bb.<span class="built_in">c_str</span>(), bb.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::string res = all.<span class="built_in">str</span>();</span><br><span class="line">    <span class="keyword">if</span> (bb.<span class="built_in">size</span>() != <span class="number">0</span> &amp;&amp; res.<span class="built_in">size</span>() != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// set PROTO_FUZZER_DUMP_PATH env to dump the serialized protobuf</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="type">const</span> <span class="type">char</span> *dump_path = <span class="built_in">getenv</span>(<span class="string">&quot;PROTO_FUZZER_DUMP_PATH&quot;</span>)) &#123;</span><br><span class="line">            <span class="function">std::ofstream <span class="title">of</span><span class="params">(dump_path)</span></span>;</span><br><span class="line">            of.<span class="built_in">write</span>(res.<span class="built_in">data</span>(), res.<span class="built_in">size</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">int</span> <span class="title">FuzzTEST</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* data, <span class="type">size_t</span> size)</span></span>; <span class="comment">// our customized fuzzing function</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">DEFINE_PROTO_FUZZER</span>(<span class="type">const</span> TEST &amp;test_proto) &#123;</span><br><span class="line">    <span class="keyword">auto</span> s = <span class="built_in">ProtoToData</span>(test_proto); <span class="comment">// convert protobuf to raw data</span></span><br><span class="line">    <span class="built_in">FuzzTEST</span>((<span class="type">const</span> <span class="type">uint8_t</span>*)s.<span class="built_in">data</span>(), s.<span class="built_in">size</span>()); <span class="comment">// fuzz the function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ–‡ä»¶çš„æœ€å¼€å¤´å¯¼å…¥ <code>libfuzzer_macro.h</code>ï¼Œ åé¢å°±å¯ä»¥ä½¿ç”¨ä¸€äº›å®æ¥å†™ä»£ç äº†ï¼Œ<code>DEFINE_PROTO_FUZZER</code> æ˜¯å…³é”®çš„ fuzzer å…¥å£ã€‚ç»“æ„åŒ–å˜å¼‚éƒ¨åˆ† libprotobuf-mutator å·²ç»å®Œæˆäº†ï¼Œéœ€è¦å®ç°çš„æ˜¯ä¸€ä¸ªç”± protobuf è½¬éœ€è¦çš„æ•°æ®ç±»å‹çš„å‡½æ•°ï¼Œå¦‚ä¸Šé¢çš„ <code>ProtoToData</code></p>
<h4 id="ä»£ç ç¼–è¯‘"><a href="#ä»£ç ç¼–è¯‘" class="headerlink" title="ä»£ç ç¼–è¯‘"></a>ä»£ç ç¼–è¯‘</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">TARGET=lpm_libfuzz</span><br><span class="line">CXX=clang++</span><br><span class="line">CXXFLAGS=-g -fsanitize=fuzzer,address</span><br><span class="line">PB_SRC=test.pb.cc</span><br><span class="line"></span><br><span class="line">PROTOBUF_DIR=<span class="variable">$(HOME)</span>/code/libprotobuf-mutator/build/external.protobuf/</span><br><span class="line">LPM_DIR=<span class="variable">$(HOME)</span>/code/AFL+/external/libprotobuf-mutator</span><br><span class="line">PROTOBUF_LIB=<span class="variable">$(PROTOBUF_DIR)</span>/lib/libprotobufd.a</span><br><span class="line">LPM_LIB=<span class="variable">$(LPM_DIR)</span>/lib/libprotobuf-mutator-libfuzzer.a <span class="variable">$(LPM_DIR)</span>/lib/libprotobuf-mutator.a</span><br><span class="line">INC=-I<span class="variable">$(PROTOBUF_DIR)</span>/<span class="keyword">include</span> -I<span class="variable">$(LPM_DIR)</span>/<span class="keyword">include</span></span><br><span class="line">DFUZZ=-DLLVMFuzzerTestOneInput=FuzzTEST</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(TARGET)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for testing libprotobuf + libfuzzer</span></span><br><span class="line"><span class="comment"># compile harness first</span></span><br><span class="line"><span class="comment"># then link lpm_libfuzz with harness.o &amp; static libraries</span></span><br><span class="line"><span class="section">harness.o: harness.cc</span></span><br><span class="line">	<span class="variable">$(CXX)</span> <span class="variable">$(CXXFLAGS)</span> -c <span class="variable">$(DFUZZ)</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET)</span>: harness.o <span class="variable">$(TARGET)</span>.cc</span><br><span class="line">	<span class="variable">$(CXX)</span> <span class="variable">$(CXXFLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> <span class="variable">$(PB_SRC)</span> <span class="variable">$(LPM_LIB)</span> <span class="variable">$(PROTOBUF_LIB)</span> <span class="variable">$(INC)</span> <span class="comment"># $(LPM_LIB) must be placed before $(PROTOBUF_LIB)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean: </span></span><br><span class="line">	rm <span class="variable">$(TARGET)</span> *.o</span><br></pre></td></tr></table></figure>

<p>make åæŠ¥é”™ï¼Œæ‰¾ä¸åˆ°å¤´æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/home/henices/code/AFL+/external/libprotobuf-mutator/include/libprotobuf-mutator/src/libfuzzer/libfuzzer_macro.h:24:10: fatal error: &#x27;port/protobuf.h&#x27; file not found</span><br><span class="line">#include &quot;port/protobuf.h&quot;</span><br><span class="line">         ^~~~~~~~~~~~~~~~~</span><br><span class="line">1 error generated.</span><br></pre></td></tr></table></figure>

<p>port&#x2F;protobuf.h  æ¥è‡ª <a target="_blank" rel="noopener" href="https://github.com/google/libprotobuf-mutator/blob/master/port/protobuf.h">https://github.com/google/libprotobuf-mutator/blob/master/port/protobuf.h</a>  ä¿®æ”¹ Makefile å¦‚ä¸‹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">TARGET=lpm_libfuzz</span><br><span class="line">CXX=clang++</span><br><span class="line">CXXFLAGS=-g -fsanitize=fuzzer,address</span><br><span class="line">PB_SRC=test.pb.cc</span><br><span class="line"></span><br><span class="line">PROTOBUF_DIR=<span class="variable">$(HOME)</span>/code/libprotobuf-mutator/build/external.protobuf/</span><br><span class="line">LPM_DIR=<span class="variable">$(HOME)</span>/code/AFL+/external/libprotobuf-mutator</span><br><span class="line">PROTOBUF_LIB=<span class="variable">$(PROTOBUF_DIR)</span>/lib/libprotobufd.a</span><br><span class="line">LPM_LIB=<span class="variable">$(LPM_DIR)</span>/lib/libprotobuf-mutator-libfuzzer.a <span class="variable">$(LPM_DIR)</span>/lib/libprotobuf-mutator.a</span><br><span class="line">INC=-I<span class="variable">$(PROTOBUF_DIR)</span>/<span class="keyword">include</span> -I<span class="variable">$(HOME)</span>/code/libprotobuf-mutator/ -I<span class="variable">$(LPM_DIR)</span>/<span class="keyword">include</span></span><br><span class="line">DFUZZ=-DLLVMFuzzerTestOneInput=FuzzTEST</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(TARGET)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for testing libprotobuf + libfuzzer</span></span><br><span class="line"><span class="comment"># compile harness first</span></span><br><span class="line"><span class="comment"># then link lpm_libfuzz with harness.o &amp; static libraries</span></span><br><span class="line"><span class="section">harness.o: harness.cc</span></span><br><span class="line">	<span class="variable">$(CXX)</span> <span class="variable">$(CXXFLAGS)</span> -c <span class="variable">$(DFUZZ)</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET)</span>: harness.o <span class="variable">$(TARGET)</span>.cc</span><br><span class="line">	<span class="variable">$(CXX)</span> <span class="variable">$(CXXFLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> <span class="variable">$(PB_SRC)</span> <span class="variable">$(LPM_LIB)</span> <span class="variable">$(PROTOBUF_LIB)</span> <span class="variable">$(INC)</span> <span class="comment"># $(LPM_LIB) must be placed before $(PROTOBUF_LIB)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean: </span></span><br><span class="line">	rm <span class="variable">$(TARGET)</span> *.o</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ makefile åï¼Œå¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡ã€‚ç»è¿‡æˆ‘ä»¬ä¸Šé¢çš„åˆ†æï¼Œä¸éœ€è¦å®šä¹‰ <code>DFUZZ=-DLLVMFuzzerTestOneInput=FuzzTEST</code> å°†è¿™è¡Œåˆ é™¤æ‰ï¼ŒåŒæ ·å¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚</p>
<p>æ‰§è¡Œ <code>lpm_libfuzz</code> è¿è¡Œæ­£å¸¸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">âœ  ./lpm_libfuzz                                                                                                                                                                                          </span><br><span class="line">INFO: found LLVMFuzzerCustomMutator (0x758a80). Disabling -len_control by default.</span><br><span class="line">INFO: Running with entropic power schedule (0xFF, 100).                                    </span><br><span class="line">INFO: Seed: 331712324                       </span><br><span class="line">INFO: Loaded 1 modules   (434 inline 8-bit counters): 434 [0xa056b8, 0xa0586a), </span><br><span class="line">INFO: Loaded 1 PC tables (434 PCs): 434 [0x939398,0x93aeb8), </span><br><span class="line">INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes</span><br><span class="line">INFO: A corpus is not provided, starting from an empty corpus</span><br><span class="line">#2      INITED cov: 82 ft: 83 corp: 1/1b exec/s: 0 rss: 35Mb</span><br><span class="line">        NEW_FUNC[1/41]: 0x75abb0 in TEST::~TEST() /tmp/genfiles/test.pb.cc:116</span><br><span class="line">        NEW_FUNC[2/41]: 0x75ca10 in google::protobuf::UnknownFieldSet* google::protobuf::internal::InternalMetadata::mutable_unknown_fields&lt;google::protobuf::UnknownFieldSet&gt;() /home/henices/code/libprotobuf-mut</span><br><span class="line">ator/build/external.protobuf//include/google/protobuf/metadata_lite.h:117</span><br><span class="line">#3      NEW    cov: 135 ft: 159 corp: 2/12b lim: 4096 exec/s: 0 rss: 36Mb L: 11/11 MS: 1 CustomCrossOver-</span><br><span class="line">#4      NEW    cov: 138 ft: 162 corp: 3/201b lim: 4096 exec/s: 0 rss: 36Mb L: 189/189 MS: 2 InsertRepeatedBytes-Custom-</span><br><span class="line">#38     REDUCE cov: 138 ft: 162 corp: 3/127b lim: 4096 exec/s: 0 rss: 37Mb L: 115/115 MS: 5 CustomCrossOver-CustomCrossOver-Custom-InsertRepeatedBytes-Custom-</span><br><span class="line">#60     REDUCE cov: 138 ft: 162 corp: 3/124b lim: 4096 exec/s: 0 rss: 37Mb L: 112/112 MS: 4 CustomCrossOver-ShuffleBytes-ChangeByte-Custom-</span><br><span class="line">#98     REDUCE cov: 138 ft: 162 corp: 3/56b lim: 4096 exec/s: 0 rss: 37Mb L: 44/44 MS: 5 CrossOver-Custom-Custom-CMP-Custom- DE: &quot;~\xff\xff\xff\xff\xff\xff\xff&quot;-</span><br><span class="line">#144    REDUCE cov: 138 ft: 162 corp: 3/53b lim: 4096 exec/s: 0 rss: 37Mb L: 41/41 MS: 2 CrossOver-Custom-</span><br><span class="line">#182    REDUCE cov: 138 ft: 162 corp: 3/25b lim: 4096 exec/s: 0 rss: 37Mb L: 13/13 MS: 5 ChangeBit-Custom-Custom-InsertByte-Custom-</span><br><span class="line">#324    REDUCE cov: 138 ft: 162 corp: 3/24b lim: 4096 exec/s: 0 rss: 38Mb L: 12/12 MS: 3 CustomCrossOver-EraseBytes-Custom-</span><br></pre></td></tr></table></figure>

<h3 id="Handling-input-from-AFL-in-our-custom-mutator"><a href="#Handling-input-from-AFL-in-our-custom-mutator" class="headerlink" title="Handling input from AFL++ in our custom mutator"></a>Handling input from AFL++ in our custom mutator</h3><p><a target="_blank" rel="noopener" href="https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning/tree/master/5_libprotobuf_aflpp_custom_mutator_input">https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning/tree/master/5_libprotobuf_aflpp_custom_mutator_input</a></p>
<p>ä¸»è¦å†…å®¹æ˜¯å°† libprotobuf-mutator å’Œ afl++ ç»“åˆèµ·æ¥ï¼Œä½¿ç”¨çš„ afl++ çš„ custom mutatorï¼Œå€¼å¾—ä¸€æçš„æ˜¯åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œéœ€è¦ä½¿ç”¨ <code>-fPIC</code> å‚æ•°ç¼–è¯‘ libprotobuf-mutatorã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cmake .. -GNinja -DCMAKE_C_COMPILER=clang -DLIB_PROTO_MUTATOR_DOWNLOAD_PROTOBUF=ON \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=/home/henices/code/AFL+/external/libprotobuf-mutator \</span><br><span class="line">-DCMAKE_CXX_COMPILER=clang++ -DCMAKE_BUILD_TYPE=Debug \</span><br><span class="line">-DCMAKE_C_FLAGS=<span class="string">&quot;-fPIC&quot;</span> -DCMAKE_CXX_FLAGS=<span class="string">&quot;-fPIC&quot;</span></span><br></pre></td></tr></table></figure>

<p>ä¸»è¦çš„æ­¥éª¤åœ¨ <a target="_blank" rel="noopener" href="https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning/blob/master/5_libprotobuf_aflpp_custom_mutator_input/README.md">readme.md</a> ä¸­å·²ç»ä»‹ç»å¾—æ¯”è¾ƒæ¸…æ¥šäº†ã€‚</p>
<ul>
<li><code>lpm_aflpp_custom_mutator_input.cc</code> æ˜¯ afl++ çš„ custom mutator shared library<ul>
<li>è§£æè¾“å…¥æ•°æ®ï¼ˆtestcase bufferï¼‰å¹¶å°†å…¶è½¬æˆ <code>TEST</code> protobuf message</li>
<li>ä½¿ç”¨ <code>libprotobuf-mutator</code> å˜å¼‚ <code>TEST</code> protobuf message</li>
<li>æ³¨å†Œä¸€ä¸ª <code>PostProcessor</code> å¤„ç†å˜å¼‚åçš„ <code>TEST</code> protobuf message ï¼ˆéå¿…è¦æ­¥éª¤ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">size_t</span> <span class="title">afl_custom_fuzz</span><span class="params">(MyMutator *mutator, <span class="comment">// return value from afl_custom_init</span></span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">uint8_t</span> *buf, <span class="type">size_t</span> buf_size, <span class="comment">// input data to be mutated</span></span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">uint8_t</span> **out_buf, <span class="comment">// output buffer</span></span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">uint8_t</span> *add_buf, <span class="type">size_t</span> add_buf_size,  <span class="comment">// add_buf can be NULL</span></span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">size_t</span> max_size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// This function can be named either &quot;afl_custom_fuzz&quot; or &quot;afl_custom_mutator&quot;</span></span><br><span class="line">    <span class="comment">// A simple test shows that &quot;buf&quot; will be the content of the current test case</span></span><br><span class="line">    <span class="comment">// &quot;add_buf&quot; will be the next test case ( from AFL++&#x27;s input queue )</span></span><br><span class="line">    </span><br><span class="line">    TEST input;</span><br><span class="line">    <span class="comment">// parse input data to TEST</span></span><br><span class="line">    <span class="comment">// Notice that input data should be a serialized protobuf data</span></span><br><span class="line">    <span class="comment">// Check ./in/ii and test_protobuf_serializer for more detail</span></span><br><span class="line">    <span class="type">bool</span> parse_ok = input.<span class="built_in">ParseFromArray</span>(buf, buf_size);</span><br><span class="line">    <span class="keyword">if</span>(!parse_ok) &#123;</span><br><span class="line">        <span class="comment">// Invalid serialize protobuf data. Don&#x27;t mutate.</span></span><br><span class="line">        <span class="comment">// Return a dummy buffer. Also mutated_size = 0</span></span><br><span class="line">        <span class="type">static</span> <span class="type">uint8_t</span> *dummy = <span class="keyword">new</span> <span class="type">uint8_t</span>[<span class="number">10</span>]; <span class="comment">// dummy buffer with no data</span></span><br><span class="line">        *out_buf = dummy;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mutate the protobuf</span></span><br><span class="line">    mutator-&gt;<span class="built_in">Mutate</span>(&amp;input, max_size);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Convert protobuf to raw data</span></span><br><span class="line">    <span class="type">const</span> TEST *p = &amp;input;</span><br><span class="line">    std::string s = <span class="built_in">ProtoToData</span>(*p);</span><br><span class="line">    <span class="comment">// Copy to a new buffer ( mutated_out )</span></span><br><span class="line">    <span class="type">size_t</span> mutated_size = s.<span class="built_in">size</span>() &lt;= max_size ? s.<span class="built_in">size</span>() : max_size; <span class="comment">// check if raw data&#x27;s size is larger than max_size</span></span><br><span class="line">    <span class="type">uint8_t</span> *mutated_out = <span class="keyword">new</span> <span class="type">uint8_t</span>[mutated_size+<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(mutated_out, s.<span class="built_in">c_str</span>(), mutated_size); <span class="comment">// copy the mutated data</span></span><br><span class="line">    <span class="comment">// Assign the mutated data and return mutated_size</span></span><br><span class="line">    *out_buf = mutated_out;</span><br><span class="line">    <span class="keyword">return</span> mutated_size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>mutator-&gt;Mutate(&amp;input, max_size);</code> ä¸ºçœŸæ­£èµ·ä½œç”¨çš„æ ¸å¿ƒä»£ç </p>
<ul>
<li><code>lpm_aflpp_custom_mutator_input.h</code>  ç»§æ‰¿äº†protobuf_mutator::Mutatorï¼Œ å¯ä»¥ä½¿ç”¨ libprotobuf-mutator çš„ Mutate æ–¹æ³•</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;libprotobuf-mutator/src/mutator.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;test.pb.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMutator</span> : <span class="keyword">public</span> protobuf_mutator::Mutator &#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>test_proto_serializer.cc</code></p>
<ul>
<li>ç”¨äºç”Ÿæˆä¸€æ¡åºåˆ—åŒ–çš„ <code>TEST</code> protobuf messageï¼Œå¯ä»¥ä½œä¸º fuzz çš„åˆå§‹åŒ– testcase ä½¿ç”¨</li>
</ul>
</li>
<li><p><code>vuln.c</code> æ¼æ´æµ‹è¯•ç¨‹åº</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> str[<span class="number">100</span>]=&#123;&#125;;</span><br><span class="line">    read(<span class="number">0</span>, str, <span class="number">100</span>);</span><br><span class="line">    <span class="type">int</span> *ptr = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>( str[<span class="number">0</span>] == <span class="string">&#x27;\x02&#x27;</span> || str[<span class="number">0</span>] == <span class="string">&#x27;\xe8&#x27;</span>) &#123;</span><br><span class="line">        *ptr = <span class="number">123</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¼æ´æµ‹è¯•ç¨‹åºæ¯”è¾ƒç®€å•ï¼Œåªè¦ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ <code>0xe8</code> æˆ–è€… <code>0x02</code> å³å¯ï¼Œlibprotobuf-mutator çš„å˜å¼‚åœ¨è¿™ä¸ªä¾‹å­é‡Œæ•ˆç‡å¹¶ä¸é«˜ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ <code>PostProcessor</code> æ¥ä¼˜åŒ–å˜å¼‚ã€‚</p>
<ul>
<li>Makefile</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">TARGET=lpm_aflpp_custom_mutator_input</span><br><span class="line">CXX=clang++-11</span><br><span class="line">AFLCC=<span class="variable">$(HOME)</span>/AFLplusplus/afl-gcc</span><br><span class="line">PB_SRC=test.pb.cc</span><br><span class="line"></span><br><span class="line">PROTOBUF_DIR=<span class="variable">$(HOME)</span>/libprotobuf-mutator/build/external.protobuf</span><br><span class="line">PROTOBUF_LIB=<span class="variable">$(PROTOBUF_DIR)</span>/lib/libprotobufd.a</span><br><span class="line"></span><br><span class="line">LPM_DIR=<span class="variable">$(HOME)</span>/libprotobuf-mutator</span><br><span class="line">LPM_LIB=<span class="variable">$(LPM_DIR)</span>/build/src/libfuzzer/libprotobuf-mutator-libfuzzer.a <span class="variable">$(LPM_DIR)</span>/build/src/libprotobuf-mutator.a</span><br><span class="line"></span><br><span class="line">INC=-I<span class="variable">$(PROTOBUF_DIR)</span>/<span class="keyword">include</span> -I<span class="variable">$(LPM_DIR)</span></span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(TARGET)</span>.so</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET)</span>.so: <span class="variable">$(TARGET)</span>.cc <span class="variable">$(PB_SRC)</span></span><br><span class="line">	<span class="variable">$(CXX)</span> -fPIC -c <span class="variable">$^</span> <span class="variable">$(INC)</span></span><br><span class="line">	<span class="variable">$(CXX)</span> -shared -Wall -O3 -o <span class="variable">$@</span> *.o <span class="variable">$(LPM_LIB)</span> <span class="variable">$(PROTOBUF_LIB)</span></span><br><span class="line"></span><br><span class="line"><span class="section">vuln: vuln.c</span></span><br><span class="line">	<span class="variable">$(AFLCC)</span> -o <span class="variable">$@</span> <span class="variable">$^</span></span><br><span class="line"></span><br><span class="line"><span class="section">test_proto_serializer: test_proto_serializer.cc <span class="variable">$(PB_SRC)</span></span></span><br><span class="line">	<span class="variable">$(CXX)</span> -o <span class="variable">$@</span> <span class="variable">$^</span> <span class="variable">$(PROTOBUF_LIB)</span> <span class="variable">$(INC)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean: </span></span><br><span class="line">	rm *.so *.o vuln test_proto_serializer</span><br></pre></td></tr></table></figure>

<p>Makefile æœ‰ç‘•ç–µï¼Œè¿™ä¸ªç« èŠ‚çš„å†…å®¹å’Œ libfuzzer æ²¡æœ‰å…³ç³»ï¼Œä¸éœ€è¦é“¾æ¥ <code>libprotobuf-mutator-libfuzzer.a</code></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/docs/cpptutorial">https://developers.google.com/protocol-buffers/docs/cpptutorial</a><br><a target="_blank" rel="noopener" href="https://github.com/google/fuzzing/blob/master/docs/structure-aware-fuzzing.md">https://github.com/google/fuzzing/blob/master/docs/structure-aware-fuzzing.md</a><br><a target="_blank" rel="noopener" href="https://github.com/google/libprotobuf-mutator/">https://github.com/google/libprotobuf-mutator/</a><br><a target="_blank" rel="noopener" href="https://llvm.org/docs/LibFuzzer.html">https://llvm.org/docs/LibFuzzer.html</a><br><a target="_blank" rel="noopener" href="https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning">https://github.com/bruce30262/libprotobuf-mutator_fuzzing_learning</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://usmacd.com/2022/05/05/How_do_you_actually_find_bugs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="henices">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | å®‰å…¨ä»£ç ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/05/How_do_you_actually_find_bugs/" class="post-title-link" itemprop="url">Keynote - How Do You Actually Find Bugs?</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-05 16:43:43" itemprop="dateCreated datePublished" datetime="2022-05-05T16:43:43+08:00">2022-05-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=7Ysy6iA2sqA&amp;ab_channel=OffensiveCon">https://www.youtube.com/watch?v=7Ysy6iA2sqA&amp;ab_channel=OffensiveCon</a></p>
<ul>
<li>Temperament<ul>
<li>Curiosity</li>
<li>Detail-oriented</li>
<li>Ability to deal with failure and continual evidence that youâ€™re wrong</li>
</ul>
</li>
<li>Learn how to deal with failure<ul>
<li>Two projects (can be unrealeted, or different parts of the same)<ul>
<li>Learn to recognize whe you have hit a wall and have become unproductive</li>
<li>Switch to your secondary project</li>
</ul>
</li>
<li>Consider having a development project as your seconary project<ul>
<li>Do an achiveable, measurable task</li>
<li>Regain a sense of achievement</li>
</ul>
</li>
</ul>
</li>
<li>Moving on - Knowning when to quit<ul>
<li>You will return it in the future</li>
</ul>
</li>
<li>Motivation - Remaining Enager<ul>
<li>The more youâ€™re curious about how a technology works or how an algorithm achives its goal, the less monotonous code review is</li>
</ul>
</li>
<li>Motivation - bug patching<ul>
<li>bugs being patched is frustrating<ul>
<li>â€¦ but they are evidence that you were on the right track!</li>
</ul>
</li>
</ul>
</li>
<li>Confidence<ul>
<li>Research is a daunting filed to enter</li>
<li>Some security reseacher you respect had the same self-doubt coming in, and have recurrences from time to time</li>
<li>Growth mindset: â€œI canâ€™t do that â€¦ Yetâ€</li>
</ul>
</li>
<li>Bias and assumptions<ul>
<li>Common code reviewer biases<ul>
<li>Everyone has looked at the already (many eyes make all bugs shallow)</li>
<li>Even if I found something, it will be unexploitable (Server side)</li>
<li>The X attack surface is not interesting now (eg, media parsing in browsers)</li>
<li>There are no more bugs in this</li>
<li>The protocol doesnâ€™t allow you to do X</li>
</ul>
</li>
</ul>
</li>
<li>Auditing Process<ul>
<li>Understanding the code</li>
<li>Documenting your findings</li>
<li>Identifying bias</li>
<li>Tooling</li>
<li>Revisit the code base</li>
<li>Analyze failures</li>
</ul>
</li>
<li>Attampt to understand the code<ul>
<li>A lot of people try to short-circuit this process<ul>
<li>Reliance on tools</li>
<li>Fuzzers&#x2F;static analyzers are a guide, not the whole process</li>
</ul>
</li>
<li>Many of todayâ€™s vulnerabilities are complex, and require in-depth understanding of the codebase</li>
<li>The more you understand about how the program works, the better equipped you are to find bugs ( and exploit them)</li>
<li>The best way to understand how something works is to explain to someone else</li>
</ul>
</li>
<li>What Iâ€™m looking for<ul>
<li>software risk &#x3D; available attack surface * complexity</li>
<li>attack surface can be indirect<ul>
<li>even mitigations are attack surface</li>
</ul>
</li>
<li>often you initial perception of attack surface is naive<ul>
<li>Hidden&#x2F;non-obvious attack surfaces are the best</li>
</ul>
</li>
<li>Complexity is plentiful<ul>
<li>Feature driven (thanks w3c)</li>
<li>Legacy support</li>
<li>Often avoidable: the anomaly of cheap complexity</li>
</ul>
</li>
</ul>
</li>
<li>Borrwoing ideas<ul>
<li>Bugtracker &#x2F; Diffs<ul>
<li>Can show where a bug is</li>
<li>Can inspire new ideas: variants, same bugs in other codebase</li>
<li>Mean but viable: track commits by error-prone developers</li>
</ul>
</li>
<li>Comments in the codebase<ul>
<li>Descripbe things Iâ€™d never thought of</li>
</ul>
</li>
</ul>
</li>
<li>Document your findings<ul>
<li>Get into the habit of documenting<ul>
<li>ideas, bugs candidates, idiosyncrasies, data structure, algorithms</li>
</ul>
</li>
<li>Documenting failed ideas is as important as documenting successful ones<ul>
<li>avoids repeating thie idea sometime later</li>
</ul>
</li>
<li>Long term view: Iâ€™m going to revisit this later</li>
</ul>
</li>
<li>Revisit code bases and failed bugs<ul>
<li>code bases are not static<ul>
<li>coee rewritten</li>
<li>Features added&#x2F;changed</li>
</ul>
</li>
<li>Environment is not static</li>
</ul>
</li>
<li>Analyze your failures<ul>
<li>if someone succeeds where you didnâ€™t, have a look at what they found</li>
<li>Try to figure out: why did I miss it?</li>
<li>Is this a one-off or teachable trick&#x2F;blind spot</li>
<li>Can you improve on that?</li>
<li>Is there a pattern in those falures?</li>
<li>Failures is an oppotunity to learn</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">henices</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
